{"version":3,"file":"chatbot-widget.js","sources":["../src/utils/shadow-dom.js","../src/utils/uuid.js","../src/utils/chat-api.js","../node_modules/dompurify/dist/purify.es.mjs","../src/components/message.js","../src/components/chat-input.js","../src/utils/history-api.js","../src/components/chat-ui.js","../src/chatbot-widget.js","../src/utils/styles.js","../src/index.js"],"sourcesContent":["export class ShadowDOMWrapper {\n  constructor(container) {\n    this.container = typeof container === 'string' \n      ? document.querySelector(container) \n      : container;\n    \n    if (!this.container) {\n      throw new Error('Container element not found');\n    }\n\n    // Check if shadow root already exists, if so use it, otherwise create new one\n    if (this.container.shadowRoot) {\n      this.shadowRoot = this.container.shadowRoot;\n      // Clear existing content\n      this.shadowRoot.innerHTML = '';\n    } else {\n      this.shadowRoot = this.container.attachShadow({ mode: 'open' });\n    }\n    \n    this.setupStyles();\n  }\n\n  setupStyles() {\n    const style = document.createElement('style');\n    style.textContent = `\n      :host {\n        all: initial;\n        display: block;\n        contain: layout style paint;\n      }\n      \n      * {\n        box-sizing: border-box;\n      }\n    `;\n    this.shadowRoot.appendChild(style);\n  }\n\n  injectStyles(cssText) {\n    const style = document.createElement('style');\n    style.textContent = cssText;\n    this.shadowRoot.appendChild(style);\n  }\n\n  appendChild(element) {\n    this.shadowRoot.appendChild(element);\n  }\n\n  querySelector(selector) {\n    return this.shadowRoot.querySelector(selector);\n  }\n\n  querySelectorAll(selector) {\n    return this.shadowRoot.querySelectorAll(selector);\n  }\n\n  destroy() {\n    if (this.container && this.container.shadowRoot) {\n      this.container.innerHTML = '';\n    }\n  }\n}","export function generateUUID() {\n  if (typeof crypto !== 'undefined' && crypto.randomUUID) {\n    return crypto.randomUUID();\n  }\n  \n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    const r = Math.random() * 16 | 0;\n    const v = c === 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}","export class ChatAPI {\n  constructor(config) {\n    this.config = config;\n    this.retryCount = 0;\n    this.maxRetries = 3;\n    this.baseDelay = 1000; // 1 second\n  }\n\n  async sendMessage(message) {\n    const payload = {\n      sessionId: this.config.sessionId,\n      clientId: this.config.clientId,\n      content: message,\n      type: \"message\"\n    };\n\n    return this.makeRequest(payload);\n  }\n\n  async makeRequest(payload, attempt = 0) {\n    try {\n      const headers = {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      };\n\n      if (this.config.siteKey) {\n        headers['x-site-key'] = this.config.siteKey;\n        console.log('Chatbot Widget: Adding x-site-key header:', this.config.siteKey);\n      } else {\n        console.warn('Chatbot Widget: No site key found in config');\n      }\n\n      const response = await fetch(this.config.apiEndpoint, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(payload)\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      \n      if (!data || typeof data.content !== 'string') {\n        throw new Error('Invalid response format from server');\n      }\n\n      return data;\n    } catch (error) {\n      if (attempt < this.maxRetries && this.isRetryableError(error)) {\n        const delay = this.calculateDelay(attempt);\n        console.warn(`Request failed, retrying in ${delay}ms... (attempt ${attempt + 1}/${this.maxRetries})`, error);\n        \n        await this.sleep(delay);\n        return this.makeRequest(payload, attempt + 1);\n      }\n\n      console.error('Chat API request failed:', error);\n      throw new Error(this.getUserFriendlyError(error));\n    }\n  }\n\n  isRetryableError(error) {\n    // Retry on network errors and 5xx server errors\n    return error.name === 'TypeError' || // Network errors\n           error.message.includes('fetch') ||\n           (error.message.includes('HTTP 5') && error.message.includes('HTTP 50')) ||\n           error.message.includes('HTTP 502') ||\n           error.message.includes('HTTP 503') ||\n           error.message.includes('HTTP 504');\n  }\n\n  calculateDelay(attempt) {\n    // Exponential backoff with jitter\n    const exponentialDelay = this.baseDelay * Math.pow(2, attempt);\n    const jitter = Math.random() * 0.1 * exponentialDelay;\n    return Math.min(exponentialDelay + jitter, 10000); // Cap at 10 seconds\n  }\n\n  getUserFriendlyError(error) {\n    if (error.message.includes('HTTP 401') || error.message.includes('HTTP 403')) {\n      return 'Access denied. This domain is not authorized to use this service.';\n    }\n    \n    if (error.message.includes('HTTP 429')) {\n      return 'Too many requests. Please wait a moment and try again.';\n    }\n    \n    if (error.message.includes('HTTP 4')) {\n      return 'Invalid request. Please check your configuration.';\n    }\n    \n    if (error.message.includes('HTTP 5') || error.name === 'TypeError') {\n      return 'Service temporarily unavailable. Please try again.';\n    }\n    \n    return 'An unexpected error occurred. Please try again.';\n  }\n\n  sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n}","/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */\n\nconst {\n  entries,\n  setPrototypeOf,\n  isFrozen,\n  getPrototypeOf,\n  getOwnPropertyDescriptor\n} = Object;\nlet {\n  freeze,\n  seal,\n  create\n} = Object; // eslint-disable-line import/no-mutable-exports\nlet {\n  apply,\n  construct\n} = typeof Reflect !== 'undefined' && Reflect;\nif (!freeze) {\n  freeze = function freeze(x) {\n    return x;\n  };\n}\nif (!seal) {\n  seal = function seal(x) {\n    return x;\n  };\n}\nif (!apply) {\n  apply = function apply(fun, thisValue, args) {\n    return fun.apply(thisValue, args);\n  };\n}\nif (!construct) {\n  construct = function construct(Func, args) {\n    return new Func(...args);\n  };\n}\nconst arrayForEach = unapply(Array.prototype.forEach);\nconst arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);\nconst arrayPop = unapply(Array.prototype.pop);\nconst arrayPush = unapply(Array.prototype.push);\nconst arraySplice = unapply(Array.prototype.splice);\nconst stringToLowerCase = unapply(String.prototype.toLowerCase);\nconst stringToString = unapply(String.prototype.toString);\nconst stringMatch = unapply(String.prototype.match);\nconst stringReplace = unapply(String.prototype.replace);\nconst stringIndexOf = unapply(String.prototype.indexOf);\nconst stringTrim = unapply(String.prototype.trim);\nconst objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\nconst regExpTest = unapply(RegExp.prototype.test);\nconst typeErrorCreate = unconstruct(TypeError);\n/**\n * Creates a new function that calls the given function with a specified thisArg and arguments.\n *\n * @param func - The function to be wrapped and called.\n * @returns A new function that calls the given function with a specified thisArg and arguments.\n */\nfunction unapply(func) {\n  return function (thisArg) {\n    if (thisArg instanceof RegExp) {\n      thisArg.lastIndex = 0;\n    }\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    return apply(func, thisArg, args);\n  };\n}\n/**\n * Creates a new function that constructs an instance of the given constructor function with the provided arguments.\n *\n * @param func - The constructor function to be wrapped and called.\n * @returns A new function that constructs an instance of the given constructor function with the provided arguments.\n */\nfunction unconstruct(func) {\n  return function () {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n    return construct(func, args);\n  };\n}\n/**\n * Add properties to a lookup table\n *\n * @param set - The set to which elements will be added.\n * @param array - The array containing elements to be added to the set.\n * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.\n * @returns The modified set with added elements.\n */\nfunction addToSet(set, array) {\n  let transformCaseFunc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : stringToLowerCase;\n  if (setPrototypeOf) {\n    // Make 'in' and truthy checks like Boolean(set.constructor)\n    // independent of any properties defined on Object.prototype.\n    // Prevent prototype setters from intercepting set as a this value.\n    setPrototypeOf(set, null);\n  }\n  let l = array.length;\n  while (l--) {\n    let element = array[l];\n    if (typeof element === 'string') {\n      const lcElement = transformCaseFunc(element);\n      if (lcElement !== element) {\n        // Config presets (e.g. tags.js, attrs.js) are immutable.\n        if (!isFrozen(array)) {\n          array[l] = lcElement;\n        }\n        element = lcElement;\n      }\n    }\n    set[element] = true;\n  }\n  return set;\n}\n/**\n * Clean up an array to harden against CSPP\n *\n * @param array - The array to be cleaned.\n * @returns The cleaned version of the array\n */\nfunction cleanArray(array) {\n  for (let index = 0; index < array.length; index++) {\n    const isPropertyExist = objectHasOwnProperty(array, index);\n    if (!isPropertyExist) {\n      array[index] = null;\n    }\n  }\n  return array;\n}\n/**\n * Shallow clone an object\n *\n * @param object - The object to be cloned.\n * @returns A new object that copies the original.\n */\nfunction clone(object) {\n  const newObject = create(null);\n  for (const [property, value] of entries(object)) {\n    const isPropertyExist = objectHasOwnProperty(object, property);\n    if (isPropertyExist) {\n      if (Array.isArray(value)) {\n        newObject[property] = cleanArray(value);\n      } else if (value && typeof value === 'object' && value.constructor === Object) {\n        newObject[property] = clone(value);\n      } else {\n        newObject[property] = value;\n      }\n    }\n  }\n  return newObject;\n}\n/**\n * This method automatically checks if the prop is function or getter and behaves accordingly.\n *\n * @param object - The object to look up the getter function in its prototype chain.\n * @param prop - The property name for which to find the getter function.\n * @returns The getter function found in the prototype chain or a fallback function.\n */\nfunction lookupGetter(object, prop) {\n  while (object !== null) {\n    const desc = getOwnPropertyDescriptor(object, prop);\n    if (desc) {\n      if (desc.get) {\n        return unapply(desc.get);\n      }\n      if (typeof desc.value === 'function') {\n        return unapply(desc.value);\n      }\n    }\n    object = getPrototypeOf(object);\n  }\n  function fallbackValue() {\n    return null;\n  }\n  return fallbackValue;\n}\n\nconst html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'section', 'select', 'shadow', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']);\nconst svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);\nconst svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']);\n// List of SVG elements that are disallowed by default.\n// We still need to know them so that we can do namespace\n// checks properly in case one wants to add them to\n// allow-list.\nconst svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);\nconst mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover', 'mprescripts']);\n// Similarly to SVG, we want to know all MathML elements,\n// even those that we disallow by default.\nconst mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);\nconst text = freeze(['#text']);\n\nconst html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'pattern', 'placeholder', 'playsinline', 'popover', 'popovertarget', 'popovertargetaction', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'wrap', 'xmlns', 'slot']);\nconst svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'amplitude', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'exponent', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'intercept', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'slope', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'tablevalues', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);\nconst mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);\nconst xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);\n\n// eslint-disable-next-line unicorn/better-regex\nconst MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\nconst ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\nconst TMPLIT_EXPR = seal(/\\$\\{[\\w\\W]*/gm); // eslint-disable-line unicorn/better-regex\nconst DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]+$/); // eslint-disable-line no-useless-escape\nconst ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\nconst IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n);\nconst IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\nconst ATTR_WHITESPACE = seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n);\nconst DOCTYPE_NAME = seal(/^html$/i);\nconst CUSTOM_ELEMENT = seal(/^[a-z][.\\w]*(-[.\\w]+)+$/i);\n\nvar EXPRESSIONS = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  ARIA_ATTR: ARIA_ATTR,\n  ATTR_WHITESPACE: ATTR_WHITESPACE,\n  CUSTOM_ELEMENT: CUSTOM_ELEMENT,\n  DATA_ATTR: DATA_ATTR,\n  DOCTYPE_NAME: DOCTYPE_NAME,\n  ERB_EXPR: ERB_EXPR,\n  IS_ALLOWED_URI: IS_ALLOWED_URI,\n  IS_SCRIPT_OR_DATA: IS_SCRIPT_OR_DATA,\n  MUSTACHE_EXPR: MUSTACHE_EXPR,\n  TMPLIT_EXPR: TMPLIT_EXPR\n});\n\n/* eslint-disable @typescript-eslint/indent */\n// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\nconst NODE_TYPE = {\n  element: 1,\n  attribute: 2,\n  text: 3,\n  cdataSection: 4,\n  entityReference: 5,\n  // Deprecated\n  entityNode: 6,\n  // Deprecated\n  progressingInstruction: 7,\n  comment: 8,\n  document: 9,\n  documentType: 10,\n  documentFragment: 11,\n  notation: 12 // Deprecated\n};\nconst getGlobal = function getGlobal() {\n  return typeof window === 'undefined' ? null : window;\n};\n/**\n * Creates a no-op policy for internal use only.\n * Don't export this function outside this module!\n * @param trustedTypes The policy factory.\n * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n * @return The policy created (or null, if Trusted Types\n * are not supported or creating the policy failed).\n */\nconst _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, purifyHostElement) {\n  if (typeof trustedTypes !== 'object' || typeof trustedTypes.createPolicy !== 'function') {\n    return null;\n  }\n  // Allow the callers to control the unique policy name\n  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n  // Policy creation with duplicate names throws in Trusted Types.\n  let suffix = null;\n  const ATTR_NAME = 'data-tt-policy-suffix';\n  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n  }\n  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n  try {\n    return trustedTypes.createPolicy(policyName, {\n      createHTML(html) {\n        return html;\n      },\n      createScriptURL(scriptUrl) {\n        return scriptUrl;\n      }\n    });\n  } catch (_) {\n    // Policy creation failed (most likely another DOMPurify script has\n    // already run). Skip creating the policy, as this will only cause errors\n    // if TT are enforced.\n    console.warn('TrustedTypes policy ' + policyName + ' could not be created.');\n    return null;\n  }\n};\nconst _createHooksMap = function _createHooksMap() {\n  return {\n    afterSanitizeAttributes: [],\n    afterSanitizeElements: [],\n    afterSanitizeShadowDOM: [],\n    beforeSanitizeAttributes: [],\n    beforeSanitizeElements: [],\n    beforeSanitizeShadowDOM: [],\n    uponSanitizeAttribute: [],\n    uponSanitizeElement: [],\n    uponSanitizeShadowNode: []\n  };\n};\nfunction createDOMPurify() {\n  let window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();\n  const DOMPurify = root => createDOMPurify(root);\n  DOMPurify.version = '3.2.6';\n  DOMPurify.removed = [];\n  if (!window || !window.document || window.document.nodeType !== NODE_TYPE.document || !window.Element) {\n    // Not running in a browser, provide a factory function\n    // so that you can pass your own Window\n    DOMPurify.isSupported = false;\n    return DOMPurify;\n  }\n  let {\n    document\n  } = window;\n  const originalDocument = document;\n  const currentScript = originalDocument.currentScript;\n  const {\n    DocumentFragment,\n    HTMLTemplateElement,\n    Node,\n    Element,\n    NodeFilter,\n    NamedNodeMap = window.NamedNodeMap || window.MozNamedAttrMap,\n    HTMLFormElement,\n    DOMParser,\n    trustedTypes\n  } = window;\n  const ElementPrototype = Element.prototype;\n  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n  const remove = lookupGetter(ElementPrototype, 'remove');\n  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');\n  // As per issue #47, the web-components registry is inherited by a\n  // new document created via createHTMLDocument. As per the spec\n  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n  // a new empty registry is used when creating a template contents owner\n  // document, so we use that as our parent document to ensure nothing\n  // is inherited.\n  if (typeof HTMLTemplateElement === 'function') {\n    const template = document.createElement('template');\n    if (template.content && template.content.ownerDocument) {\n      document = template.content.ownerDocument;\n    }\n  }\n  let trustedTypesPolicy;\n  let emptyHTML = '';\n  const {\n    implementation,\n    createNodeIterator,\n    createDocumentFragment,\n    getElementsByTagName\n  } = document;\n  const {\n    importNode\n  } = originalDocument;\n  let hooks = _createHooksMap();\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  DOMPurify.isSupported = typeof entries === 'function' && typeof getParentNode === 'function' && implementation && implementation.createHTMLDocument !== undefined;\n  const {\n    MUSTACHE_EXPR,\n    ERB_EXPR,\n    TMPLIT_EXPR,\n    DATA_ATTR,\n    ARIA_ATTR,\n    IS_SCRIPT_OR_DATA,\n    ATTR_WHITESPACE,\n    CUSTOM_ELEMENT\n  } = EXPRESSIONS;\n  let {\n    IS_ALLOWED_URI: IS_ALLOWED_URI$1\n  } = EXPRESSIONS;\n  /**\n   * We consider the elements and attributes below to be safe. Ideally\n   * don't add any new ones but feel free to remove unwanted ones.\n   */\n  /* allowed element names */\n  let ALLOWED_TAGS = null;\n  const DEFAULT_ALLOWED_TAGS = addToSet({}, [...html$1, ...svg$1, ...svgFilters, ...mathMl$1, ...text]);\n  /* Allowed attribute names */\n  let ALLOWED_ATTR = null;\n  const DEFAULT_ALLOWED_ATTR = addToSet({}, [...html, ...svg, ...mathMl, ...xml]);\n  /*\n   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.\n   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n   */\n  let CUSTOM_ELEMENT_HANDLING = Object.seal(create(null, {\n    tagNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    attributeNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    allowCustomizedBuiltInElements: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: false\n    }\n  }));\n  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n  let FORBID_TAGS = null;\n  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n  let FORBID_ATTR = null;\n  /* Decide if ARIA attributes are okay */\n  let ALLOW_ARIA_ATTR = true;\n  /* Decide if custom data attributes are okay */\n  let ALLOW_DATA_ATTR = true;\n  /* Decide if unknown protocols are okay */\n  let ALLOW_UNKNOWN_PROTOCOLS = false;\n  /* Decide if self-closing tags in attributes are allowed.\n   * Usually removed due to a mXSS issue in jQuery 3.0 */\n  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n  /* Output should be safe for common template engines.\n   * This means, DOMPurify removes data attributes, mustaches and ERB\n   */\n  let SAFE_FOR_TEMPLATES = false;\n  /* Output should be safe even for XML used within HTML and alike.\n   * This means, DOMPurify removes comments when containing risky content.\n   */\n  let SAFE_FOR_XML = true;\n  /* Decide if document with <html>... should be returned */\n  let WHOLE_DOCUMENT = false;\n  /* Track whether config is already set on this instance of DOMPurify. */\n  let SET_CONFIG = false;\n  /* Decide if all elements (e.g. style, script) must be children of\n   * document.body. By default, browsers might move them to document.head */\n  let FORCE_BODY = false;\n  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n   * string (or a TrustedHTML object if Trusted Types are supported).\n   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n   */\n  let RETURN_DOM = false;\n  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n   * string  (or a TrustedHTML object if Trusted Types are supported) */\n  let RETURN_DOM_FRAGMENT = false;\n  /* Try to return a Trusted Type object instead of a string, return a string in\n   * case Trusted Types are not supported  */\n  let RETURN_TRUSTED_TYPE = false;\n  /* Output should be free from DOM clobbering attacks?\n   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n   */\n  let SANITIZE_DOM = true;\n  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n   *\n   * HTML/DOM spec rules that enable DOM Clobbering:\n   *   - Named Access on Window (§7.3.3)\n   *   - DOM Tree Accessors (§3.1.5)\n   *   - Form Element Parent-Child Relations (§4.10.3)\n   *   - Iframe srcdoc / Nested WindowProxies (§4.8.5)\n   *   - HTMLCollection (§4.2.10.2)\n   *\n   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n   * with a constant string, i.e., `user-content-`\n   */\n  let SANITIZE_NAMED_PROPS = false;\n  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n  /* Keep element content when removing element? */\n  let KEEP_CONTENT = true;\n  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n   * of importing it into a new Document and returning a sanitized copy */\n  let IN_PLACE = false;\n  /* Allow usage of profiles like html, svg and mathMl */\n  let USE_PROFILES = {};\n  /* Tags to ignore content of when KEEP_CONTENT is true */\n  let FORBID_CONTENTS = null;\n  const DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);\n  /* Tags that are safe for data: URIs */\n  let DATA_URI_TAGS = null;\n  const DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);\n  /* Attributes safe for values like \"javascript:\" */\n  let URI_SAFE_ATTRIBUTES = null;\n  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);\n  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n  /* Document namespace */\n  let NAMESPACE = HTML_NAMESPACE;\n  let IS_EMPTY_INPUT = false;\n  /* Allowed XHTML+XML namespaces */\n  let ALLOWED_NAMESPACES = null;\n  const DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);\n  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);\n  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);\n  // Certain elements are allowed in both SVG and HTML\n  // namespace. We need to specify them explicitly\n  // so that they don't get erroneously deleted from\n  // HTML namespace.\n  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);\n  /* Parsing of strict XHTML documents */\n  let PARSER_MEDIA_TYPE = null;\n  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n  let transformCaseFunc = null;\n  /* Keep a reference to config to pass to hooks */\n  let CONFIG = null;\n  /* Ideally, do not touch anything below this line */\n  /* ______________________________________________ */\n  const formElement = document.createElement('form');\n  const isRegexOrFunction = function isRegexOrFunction(testValue) {\n    return testValue instanceof RegExp || testValue instanceof Function;\n  };\n  /**\n   * _parseConfig\n   *\n   * @param cfg optional config literal\n   */\n  // eslint-disable-next-line complexity\n  const _parseConfig = function _parseConfig() {\n    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (CONFIG && CONFIG === cfg) {\n      return;\n    }\n    /* Shield configuration object from tampering */\n    if (!cfg || typeof cfg !== 'object') {\n      cfg = {};\n    }\n    /* Shield configuration object from prototype pollution */\n    cfg = clone(cfg);\n    PARSER_MEDIA_TYPE =\n    // eslint-disable-next-line unicorn/prefer-includes\n    SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? DEFAULT_PARSER_MEDIA_TYPE : cfg.PARSER_MEDIA_TYPE;\n    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n    transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;\n    /* Set configuration parameters */\n    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS') ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;\n    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR') ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;\n    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES') ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;\n    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR') ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), cfg.ADD_URI_SAFE_ATTR, transformCaseFunc) : DEFAULT_URI_SAFE_ATTRIBUTES;\n    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS') ? addToSet(clone(DEFAULT_DATA_URI_TAGS), cfg.ADD_DATA_URI_TAGS, transformCaseFunc) : DEFAULT_DATA_URI_TAGS;\n    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS') ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;\n    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS') ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : clone({});\n    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR') ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : clone({});\n    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES') ? cfg.USE_PROFILES : false;\n    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true\n    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n    IN_PLACE = cfg.IN_PLACE || false; // Default false\n    IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI;\n    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n    MATHML_TEXT_INTEGRATION_POINTS = cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;\n    HTML_INTEGRATION_POINTS = cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;\n    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n    }\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n    }\n    if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {\n      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n    }\n    if (SAFE_FOR_TEMPLATES) {\n      ALLOW_DATA_ATTR = false;\n    }\n    if (RETURN_DOM_FRAGMENT) {\n      RETURN_DOM = true;\n    }\n    /* Parse profile info */\n    if (USE_PROFILES) {\n      ALLOWED_TAGS = addToSet({}, text);\n      ALLOWED_ATTR = [];\n      if (USE_PROFILES.html === true) {\n        addToSet(ALLOWED_TAGS, html$1);\n        addToSet(ALLOWED_ATTR, html);\n      }\n      if (USE_PROFILES.svg === true) {\n        addToSet(ALLOWED_TAGS, svg$1);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n      if (USE_PROFILES.svgFilters === true) {\n        addToSet(ALLOWED_TAGS, svgFilters);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n      if (USE_PROFILES.mathMl === true) {\n        addToSet(ALLOWED_TAGS, mathMl$1);\n        addToSet(ALLOWED_ATTR, mathMl);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n    }\n    /* Merge configuration parameters */\n    if (cfg.ADD_TAGS) {\n      if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n        ALLOWED_TAGS = clone(ALLOWED_TAGS);\n      }\n      addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n    }\n    if (cfg.ADD_ATTR) {\n      if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n        ALLOWED_ATTR = clone(ALLOWED_ATTR);\n      }\n      addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n    }\n    if (cfg.ADD_URI_SAFE_ATTR) {\n      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n    }\n    if (cfg.FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n    }\n    /* Add #text in case KEEP_CONTENT is set to true */\n    if (KEEP_CONTENT) {\n      ALLOWED_TAGS['#text'] = true;\n    }\n    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n    if (WHOLE_DOCUMENT) {\n      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n    }\n    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n    if (ALLOWED_TAGS.table) {\n      addToSet(ALLOWED_TAGS, ['tbody']);\n      delete FORBID_TAGS.tbody;\n    }\n    if (cfg.TRUSTED_TYPES_POLICY) {\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.');\n      }\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.');\n      }\n      // Overwrite existing TrustedTypes policy.\n      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;\n      // Sign local variables required by `sanitize`.\n      emptyHTML = trustedTypesPolicy.createHTML('');\n    } else {\n      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n      if (trustedTypesPolicy === undefined) {\n        trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, currentScript);\n      }\n      // If creating the internal policy succeeded sign internal variables.\n      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n        emptyHTML = trustedTypesPolicy.createHTML('');\n      }\n    }\n    // Prevent further manipulation of configuration.\n    // Not available in IE8, Safari 5, etc.\n    if (freeze) {\n      freeze(cfg);\n    }\n    CONFIG = cfg;\n  };\n  /* Keep track of all possible SVG and MathML tags\n   * so that we can perform the namespace checks\n   * correctly. */\n  const ALL_SVG_TAGS = addToSet({}, [...svg$1, ...svgFilters, ...svgDisallowed]);\n  const ALL_MATHML_TAGS = addToSet({}, [...mathMl$1, ...mathMlDisallowed]);\n  /**\n   * @param element a DOM element whose namespace is being checked\n   * @returns Return false if the element has a\n   *  namespace that a spec-compliant parser would never\n   *  return. Return true otherwise.\n   */\n  const _checkValidNamespace = function _checkValidNamespace(element) {\n    let parent = getParentNode(element);\n    // In JSDOM, if we're inside shadow DOM, then parentNode\n    // can be null. We just simulate parent in this case.\n    if (!parent || !parent.tagName) {\n      parent = {\n        namespaceURI: NAMESPACE,\n        tagName: 'template'\n      };\n    }\n    const tagName = stringToLowerCase(element.tagName);\n    const parentTagName = stringToLowerCase(parent.tagName);\n    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return false;\n    }\n    if (element.namespaceURI === SVG_NAMESPACE) {\n      // The only way to switch from HTML namespace to SVG\n      // is via <svg>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'svg';\n      }\n      // The only way to switch from MathML to SVG is via`\n      // svg if parent is either <annotation-xml> or MathML\n      // text integration points.\n      if (parent.namespaceURI === MATHML_NAMESPACE) {\n        return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);\n      }\n      // We only allow elements that are defined in SVG\n      // spec. All others are disallowed in SVG namespace.\n      return Boolean(ALL_SVG_TAGS[tagName]);\n    }\n    if (element.namespaceURI === MATHML_NAMESPACE) {\n      // The only way to switch from HTML namespace to MathML\n      // is via <math>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'math';\n      }\n      // The only way to switch from SVG to MathML is via\n      // <math> and HTML integration points\n      if (parent.namespaceURI === SVG_NAMESPACE) {\n        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n      }\n      // We only allow elements that are defined in MathML\n      // spec. All others are disallowed in MathML namespace.\n      return Boolean(ALL_MATHML_TAGS[tagName]);\n    }\n    if (element.namespaceURI === HTML_NAMESPACE) {\n      // The only way to switch from SVG to HTML is via\n      // HTML integration points, and from MathML to HTML\n      // is via MathML text integration points\n      if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      }\n      if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      }\n      // We disallow tags that are specific for MathML\n      // or SVG and should never appear in HTML namespace\n      return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);\n    }\n    // For XHTML and XML documents that support custom namespaces\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return true;\n    }\n    // The code should never reach this place (this means\n    // that the element somehow got namespace that is not\n    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n    // Return false just in case.\n    return false;\n  };\n  /**\n   * _forceRemove\n   *\n   * @param node a DOM node\n   */\n  const _forceRemove = function _forceRemove(node) {\n    arrayPush(DOMPurify.removed, {\n      element: node\n    });\n    try {\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      getParentNode(node).removeChild(node);\n    } catch (_) {\n      remove(node);\n    }\n  };\n  /**\n   * _removeAttribute\n   *\n   * @param name an Attribute name\n   * @param element a DOM node\n   */\n  const _removeAttribute = function _removeAttribute(name, element) {\n    try {\n      arrayPush(DOMPurify.removed, {\n        attribute: element.getAttributeNode(name),\n        from: element\n      });\n    } catch (_) {\n      arrayPush(DOMPurify.removed, {\n        attribute: null,\n        from: element\n      });\n    }\n    element.removeAttribute(name);\n    // We void attribute values for unremovable \"is\" attributes\n    if (name === 'is') {\n      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n        try {\n          _forceRemove(element);\n        } catch (_) {}\n      } else {\n        try {\n          element.setAttribute(name, '');\n        } catch (_) {}\n      }\n    }\n  };\n  /**\n   * _initDocument\n   *\n   * @param dirty - a string of dirty markup\n   * @return a DOM, filled with the dirty markup\n   */\n  const _initDocument = function _initDocument(dirty) {\n    /* Create a HTML document */\n    let doc = null;\n    let leadingWhitespace = null;\n    if (FORCE_BODY) {\n      dirty = '<remove></remove>' + dirty;\n    } else {\n      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n      leadingWhitespace = matches && matches[0];\n    }\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {\n      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n      dirty = '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' + dirty + '</body></html>';\n    }\n    const dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;\n    /*\n     * Use the DOMParser API by default, fallback later if needs be\n     * DOMParser not work for svg when has multiple root element.\n     */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      try {\n        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n      } catch (_) {}\n    }\n    /* Use createHTMLDocument in case DOMParser is not available */\n    if (!doc || !doc.documentElement) {\n      doc = implementation.createDocument(NAMESPACE, 'template', null);\n      try {\n        doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;\n      } catch (_) {\n        // Syntax error if dirtyPayload is invalid xml\n      }\n    }\n    const body = doc.body || doc.documentElement;\n    if (dirty && leadingWhitespace) {\n      body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);\n    }\n    /* Work on whole document or just its body */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];\n    }\n    return WHOLE_DOCUMENT ? doc.documentElement : body;\n  };\n  /**\n   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n   *\n   * @param root The root element or node to start traversing on.\n   * @return The created NodeIterator\n   */\n  const _createNodeIterator = function _createNodeIterator(root) {\n    return createNodeIterator.call(root.ownerDocument || root, root,\n    // eslint-disable-next-line no-bitwise\n    NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT | NodeFilter.SHOW_PROCESSING_INSTRUCTION | NodeFilter.SHOW_CDATA_SECTION, null);\n  };\n  /**\n   * _isClobbered\n   *\n   * @param element element to check for clobbering attacks\n   * @return true if clobbered, false if safe\n   */\n  const _isClobbered = function _isClobbered(element) {\n    return element instanceof HTMLFormElement && (typeof element.nodeName !== 'string' || typeof element.textContent !== 'string' || typeof element.removeChild !== 'function' || !(element.attributes instanceof NamedNodeMap) || typeof element.removeAttribute !== 'function' || typeof element.setAttribute !== 'function' || typeof element.namespaceURI !== 'string' || typeof element.insertBefore !== 'function' || typeof element.hasChildNodes !== 'function');\n  };\n  /**\n   * Checks whether the given object is a DOM node.\n   *\n   * @param value object to check whether it's a DOM node\n   * @return true is object is a DOM node\n   */\n  const _isNode = function _isNode(value) {\n    return typeof Node === 'function' && value instanceof Node;\n  };\n  function _executeHooks(hooks, currentNode, data) {\n    arrayForEach(hooks, hook => {\n      hook.call(DOMPurify, currentNode, data, CONFIG);\n    });\n  }\n  /**\n   * _sanitizeElements\n   *\n   * @protect nodeName\n   * @protect textContent\n   * @protect removeChild\n   * @param currentNode to check for permission to exist\n   * @return true if node was killed, false if left alive\n   */\n  const _sanitizeElements = function _sanitizeElements(currentNode) {\n    let content = null;\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);\n    /* Check if element is clobbered or can clobber */\n    if (_isClobbered(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Now let's check the element's type and name */\n    const tagName = transformCaseFunc(currentNode.nodeName);\n    /* Execute a hook if present */\n    _executeHooks(hooks.uponSanitizeElement, currentNode, {\n      tagName,\n      allowedTags: ALLOWED_TAGS\n    });\n    /* Detect mXSS attempts abusing namespace confusion */\n    if (SAFE_FOR_XML && currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && regExpTest(/<[/\\w!]/g, currentNode.innerHTML) && regExpTest(/<[/\\w!]/g, currentNode.textContent)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove any occurrence of processing instructions */\n    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove any kind of possibly harmful comments */\n    if (SAFE_FOR_XML && currentNode.nodeType === NODE_TYPE.comment && regExpTest(/<[/\\w]/g, currentNode.data)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove element if anything forbids its presence */\n    if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n      /* Check if we have a custom element to handle */\n      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) {\n          return false;\n        }\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) {\n          return false;\n        }\n      }\n      /* Keep content except for bad-listed elements */\n      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n        if (childNodes && parentNode) {\n          const childCount = childNodes.length;\n          for (let i = childCount - 1; i >= 0; --i) {\n            const childClone = cloneNode(childNodes[i], true);\n            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;\n            parentNode.insertBefore(childClone, getNextSibling(currentNode));\n          }\n        }\n      }\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Check whether element has a valid namespace */\n    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Make sure that older browsers don't get fallback-tag mXSS */\n    if ((tagName === 'noscript' || tagName === 'noembed' || tagName === 'noframes') && regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Sanitize element content to be template-safe */\n    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {\n      /* Get the element's text content */\n      content = currentNode.textContent;\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n        content = stringReplace(content, expr, ' ');\n      });\n      if (currentNode.textContent !== content) {\n        arrayPush(DOMPurify.removed, {\n          element: currentNode.cloneNode()\n        });\n        currentNode.textContent = content;\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeElements, currentNode, null);\n    return false;\n  };\n  /**\n   * _isValidAttribute\n   *\n   * @param lcTag Lowercase tag name of containing element.\n   * @param lcName Lowercase attribute name.\n   * @param value Attribute value.\n   * @return Returns true if `value` is valid, otherwise false.\n   */\n  // eslint-disable-next-line complexity\n  const _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {\n    /* Make sure attribute cannot clobber */\n    if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {\n      return false;\n    }\n    /* Allow valid data-* attributes: At least one character after \"-\"\n        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n        We don't need to check the value; it's always URI safe. */\n    if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n      if (\n      // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n      // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n      _isBasicCustomElement(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName)) ||\n      // Alternative, second condition checks if it's an `is`-attribute, AND\n      // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {\n        return false;\n      }\n      /* Check value is safe. First, is attr inert? If so, is safe */\n    } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if (value) {\n      return false;\n    } else ;\n    return true;\n  };\n  /**\n   * _isBasicCustomElement\n   * checks if at least one dash is included in tagName, and it's not the first char\n   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n   *\n   * @param tagName name of the tag of the node to sanitize\n   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.\n   */\n  const _isBasicCustomElement = function _isBasicCustomElement(tagName) {\n    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);\n  };\n  /**\n   * _sanitizeAttributes\n   *\n   * @protect attributes\n   * @protect nodeName\n   * @protect removeAttribute\n   * @protect setAttribute\n   *\n   * @param currentNode to sanitize\n   */\n  const _sanitizeAttributes = function _sanitizeAttributes(currentNode) {\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);\n    const {\n      attributes\n    } = currentNode;\n    /* Check if we have attributes; if not we might have a text node */\n    if (!attributes || _isClobbered(currentNode)) {\n      return;\n    }\n    const hookEvent = {\n      attrName: '',\n      attrValue: '',\n      keepAttr: true,\n      allowedAttributes: ALLOWED_ATTR,\n      forceKeepAttr: undefined\n    };\n    let l = attributes.length;\n    /* Go backwards over all attributes; safely remove bad ones */\n    while (l--) {\n      const attr = attributes[l];\n      const {\n        name,\n        namespaceURI,\n        value: attrValue\n      } = attr;\n      const lcName = transformCaseFunc(name);\n      const initValue = attrValue;\n      let value = name === 'value' ? initValue : stringTrim(initValue);\n      /* Execute a hook if present */\n      hookEvent.attrName = lcName;\n      hookEvent.attrValue = value;\n      hookEvent.keepAttr = true;\n      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);\n      value = hookEvent.attrValue;\n      /* Full DOM Clobbering protection via namespace isolation,\n       * Prefix id and name attributes with `user-content-`\n       */\n      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n        // Remove the attribute with this value\n        _removeAttribute(name, currentNode);\n        // Prefix the value and later re-create the attribute with the sanitized value\n        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n      }\n      /* Work around a security issue with comments inside attributes */\n      if (SAFE_FOR_XML && regExpTest(/((--!?|])>)|<\\/(style|title)/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Did the hooks approve of the attribute? */\n      if (hookEvent.forceKeepAttr) {\n        continue;\n      }\n      /* Did the hooks approve of the attribute? */\n      if (!hookEvent.keepAttr) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Work around a security issue in jQuery 3.0 */\n      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Sanitize attribute content to be template-safe */\n      if (SAFE_FOR_TEMPLATES) {\n        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n          value = stringReplace(value, expr, ' ');\n        });\n      }\n      /* Is `value` valid for this attribute? */\n      const lcTag = transformCaseFunc(currentNode.nodeName);\n      if (!_isValidAttribute(lcTag, lcName, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Handle attributes that require Trusted Types */\n      if (trustedTypesPolicy && typeof trustedTypes === 'object' && typeof trustedTypes.getAttributeType === 'function') {\n        if (namespaceURI) ; else {\n          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n            case 'TrustedHTML':\n              {\n                value = trustedTypesPolicy.createHTML(value);\n                break;\n              }\n            case 'TrustedScriptURL':\n              {\n                value = trustedTypesPolicy.createScriptURL(value);\n                break;\n              }\n          }\n        }\n      }\n      /* Handle invalid data-* attribute set by try-catching it */\n      if (value !== initValue) {\n        try {\n          if (namespaceURI) {\n            currentNode.setAttributeNS(namespaceURI, name, value);\n          } else {\n            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n            currentNode.setAttribute(name, value);\n          }\n          if (_isClobbered(currentNode)) {\n            _forceRemove(currentNode);\n          } else {\n            arrayPop(DOMPurify.removed);\n          }\n        } catch (_) {\n          _removeAttribute(name, currentNode);\n        }\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);\n  };\n  /**\n   * _sanitizeShadowDOM\n   *\n   * @param fragment to iterate over recursively\n   */\n  const _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {\n    let shadowNode = null;\n    const shadowIterator = _createNodeIterator(fragment);\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);\n    while (shadowNode = shadowIterator.nextNode()) {\n      /* Execute a hook if present */\n      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);\n      /* Sanitize tags and elements */\n      _sanitizeElements(shadowNode);\n      /* Check attributes next */\n      _sanitizeAttributes(shadowNode);\n      /* Deep shadow DOM detected */\n      if (shadowNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(shadowNode.content);\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);\n  };\n  // eslint-disable-next-line complexity\n  DOMPurify.sanitize = function (dirty) {\n    let cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let body = null;\n    let importedNode = null;\n    let currentNode = null;\n    let returnNode = null;\n    /* Make sure we have a string to sanitize.\n      DO NOT return early, as this will return the wrong type if\n      the user has requested a DOM object rather than a string */\n    IS_EMPTY_INPUT = !dirty;\n    if (IS_EMPTY_INPUT) {\n      dirty = '<!-->';\n    }\n    /* Stringify, in case dirty is an object */\n    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n      if (typeof dirty.toString === 'function') {\n        dirty = dirty.toString();\n        if (typeof dirty !== 'string') {\n          throw typeErrorCreate('dirty is not a string, aborting');\n        }\n      } else {\n        throw typeErrorCreate('toString is not a function');\n      }\n    }\n    /* Return dirty HTML if DOMPurify cannot run */\n    if (!DOMPurify.isSupported) {\n      return dirty;\n    }\n    /* Assign config vars */\n    if (!SET_CONFIG) {\n      _parseConfig(cfg);\n    }\n    /* Clean up removed elements */\n    DOMPurify.removed = [];\n    /* Check if dirty is correctly typed for IN_PLACE */\n    if (typeof dirty === 'string') {\n      IN_PLACE = false;\n    }\n    if (IN_PLACE) {\n      /* Do some early pre-sanitization to avoid unsafe root nodes */\n      if (dirty.nodeName) {\n        const tagName = transformCaseFunc(dirty.nodeName);\n        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n          throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');\n        }\n      }\n    } else if (dirty instanceof Node) {\n      /* If dirty is a DOM element, append to an empty document to avoid\n         elements being stripped by the parser */\n      body = _initDocument('<!---->');\n      importedNode = body.ownerDocument.importNode(dirty, true);\n      if (importedNode.nodeType === NODE_TYPE.element && importedNode.nodeName === 'BODY') {\n        /* Node is already a body, use as is */\n        body = importedNode;\n      } else if (importedNode.nodeName === 'HTML') {\n        body = importedNode;\n      } else {\n        // eslint-disable-next-line unicorn/prefer-dom-node-append\n        body.appendChild(importedNode);\n      }\n    } else {\n      /* Exit directly if we have nothing to do */\n      if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT &&\n      // eslint-disable-next-line unicorn/prefer-includes\n      dirty.indexOf('<') === -1) {\n        return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;\n      }\n      /* Initialize the document to work on */\n      body = _initDocument(dirty);\n      /* Check we have a DOM node from the data */\n      if (!body) {\n        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n      }\n    }\n    /* Remove first element node (ours) if FORCE_BODY is set */\n    if (body && FORCE_BODY) {\n      _forceRemove(body.firstChild);\n    }\n    /* Get node iterator */\n    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);\n    /* Now start iterating over the created document */\n    while (currentNode = nodeIterator.nextNode()) {\n      /* Sanitize tags and elements */\n      _sanitizeElements(currentNode);\n      /* Check attributes next */\n      _sanitizeAttributes(currentNode);\n      /* Shadow DOM detected, sanitize it */\n      if (currentNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(currentNode.content);\n      }\n    }\n    /* If we sanitized `dirty` in-place, return it. */\n    if (IN_PLACE) {\n      return dirty;\n    }\n    /* Return sanitized string or DOM */\n    if (RETURN_DOM) {\n      if (RETURN_DOM_FRAGMENT) {\n        returnNode = createDocumentFragment.call(body.ownerDocument);\n        while (body.firstChild) {\n          // eslint-disable-next-line unicorn/prefer-dom-node-append\n          returnNode.appendChild(body.firstChild);\n        }\n      } else {\n        returnNode = body;\n      }\n      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n        /*\n          AdoptNode() is not used because internal state is not reset\n          (e.g. the past names map of a HTMLFormElement), this is safe\n          in theory but we would rather not risk another attack vector.\n          The state that is cloned by importNode() is explicitly defined\n          by the specs.\n        */\n        returnNode = importNode.call(originalDocument, returnNode, true);\n      }\n      return returnNode;\n    }\n    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n    /* Serialize doctype if allowed */\n    if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {\n      serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n    }\n    /* Sanitize final string template-safe */\n    if (SAFE_FOR_TEMPLATES) {\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n        serializedHTML = stringReplace(serializedHTML, expr, ' ');\n      });\n    }\n    return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;\n  };\n  DOMPurify.setConfig = function () {\n    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _parseConfig(cfg);\n    SET_CONFIG = true;\n  };\n  DOMPurify.clearConfig = function () {\n    CONFIG = null;\n    SET_CONFIG = false;\n  };\n  DOMPurify.isValidAttribute = function (tag, attr, value) {\n    /* Initialize shared config vars if necessary. */\n    if (!CONFIG) {\n      _parseConfig({});\n    }\n    const lcTag = transformCaseFunc(tag);\n    const lcName = transformCaseFunc(attr);\n    return _isValidAttribute(lcTag, lcName, value);\n  };\n  DOMPurify.addHook = function (entryPoint, hookFunction) {\n    if (typeof hookFunction !== 'function') {\n      return;\n    }\n    arrayPush(hooks[entryPoint], hookFunction);\n  };\n  DOMPurify.removeHook = function (entryPoint, hookFunction) {\n    if (hookFunction !== undefined) {\n      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);\n      return index === -1 ? undefined : arraySplice(hooks[entryPoint], index, 1)[0];\n    }\n    return arrayPop(hooks[entryPoint]);\n  };\n  DOMPurify.removeHooks = function (entryPoint) {\n    hooks[entryPoint] = [];\n  };\n  DOMPurify.removeAllHooks = function () {\n    hooks = _createHooksMap();\n  };\n  return DOMPurify;\n}\nvar purify = createDOMPurify();\n\nexport { purify as default };\n//# sourceMappingURL=purify.es.mjs.map\n","import DOMPurify from 'dompurify';\n\nexport class Message {\n  constructor(content, type = 'user', timestamp = new Date(), isLoading = false) {\n    this.content = content;\n    this.type = type; // 'user' or 'bot'\n    this.timestamp = timestamp;\n    this.isLoading = isLoading;\n    this.element = this.createElement();\n  }\n\n  createElement() {\n    const messageContainer = document.createElement('div');\n    messageContainer.className = `message message--${this.type}`;\n    messageContainer.setAttribute('role', 'log');\n    \n    const messageContent = document.createElement('div');\n    messageContent.className = 'message__content';\n    \n    if (this.isLoading) {\n      this.createLoadingContent(messageContent);\n    } else {\n      this.createTextContent(messageContent);\n    }\n    \n    const messageTime = document.createElement('div');\n    messageTime.className = 'message__time';\n    messageTime.textContent = this.formatTime(this.timestamp);\n    messageTime.setAttribute('aria-label', `Sent at ${this.formatTime(this.timestamp, true)}`);\n    \n    messageContainer.appendChild(messageContent);\n    messageContainer.appendChild(messageTime);\n    \n    // Add animation class for entrance\n    messageContainer.classList.add('message--entering');\n    \n    // Remove animation class after animation completes\n    requestAnimationFrame(() => {\n      messageContainer.classList.remove('message--entering');\n    });\n    \n    return messageContainer;\n  }\n\n  createLoadingContent(messageContent) {\n    messageContent.innerHTML = '';\n    messageContent.setAttribute('aria-label', 'Bot is typing');\n    \n    const typingDots = document.createElement('div');\n    typingDots.className = 'typing-dots';\n    \n    for (let i = 0; i < 3; i++) {\n      const dot = document.createElement('div');\n      dot.className = 'typing-dot';\n      typingDots.appendChild(dot);\n    }\n    \n    messageContent.appendChild(typingDots);\n  }\n\n  createTextContent(messageContent) {\n    // Sanitize content before inserting\n    const sanitizedContent = DOMPurify.sanitize(this.content, {\n      ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'code', 'pre'],\n      ALLOWED_ATTR: []\n    });\n    \n    messageContent.innerHTML = sanitizedContent;\n    messageContent.removeAttribute('aria-label');\n  }\n\n  updateContent(newContent) {\n    this.content = newContent;\n    this.isLoading = false;\n    \n    const messageContent = this.element.querySelector('.message__content');\n    \n    // Add a smooth transition effect\n    messageContent.style.opacity = '0.7';\n    \n    setTimeout(() => {\n      this.createTextContent(messageContent);\n      messageContent.style.opacity = '1';\n    }, 150);\n  }\n\n  formatTime(date, verbose = false) {\n    const hours = date.getHours();\n    const minutes = date.getMinutes();\n    const ampm = hours >= 12 ? 'PM' : 'AM';\n    const displayHours = hours % 12 || 12;\n    \n    if (verbose) {\n      return `${displayHours}:${minutes.toString().padStart(2, '0')} ${ampm}`;\n    }\n    \n    return `${displayHours}:${minutes.toString().padStart(2, '0')}`;\n  }\n\n  getElement() {\n    return this.element;\n  }\n\n  static createLoadingMessage() {\n    return new Message('', 'bot', new Date(), true);\n  }\n\n  static createErrorMessage(errorText) {\n    const message = new Message(errorText, 'bot');\n    message.element.classList.add('message--error');\n    return message;\n  }\n}","export class ChatInput {\n  constructor(onSendMessage) {\n    this.onSendMessage = onSendMessage;\n    this.isDisabled = false;\n    this.element = this.createElement();\n    this.setupEventListeners();\n  }\n\n  createElement() {\n    const container = document.createElement('div');\n    container.className = 'chat-input';\n    \n    const form = document.createElement('form');\n    form.className = 'chat-input__form';\n    \n    const inputContainer = document.createElement('div');\n    inputContainer.className = 'chat-input__container';\n    \n    const textarea = document.createElement('textarea');\n    textarea.className = 'chat-input__textarea';\n    textarea.placeholder = 'Type your message...';\n    textarea.rows = 1;\n    textarea.setAttribute('aria-label', 'Type your message');\n    textarea.setAttribute('maxlength', '2000');\n    // Prevent iOS Safari auto-zoom by setting font-size to 16px minimum\n    textarea.style.fontSize = '16px';\n    \n    const sendButton = document.createElement('button');\n    sendButton.type = 'submit';\n    sendButton.className = 'chat-input__send';\n    sendButton.setAttribute('aria-label', 'Send message');\n    sendButton.innerHTML = this.getSendIcon();\n    \n    inputContainer.appendChild(textarea);\n    inputContainer.appendChild(sendButton);\n    form.appendChild(inputContainer);\n    container.appendChild(form);\n    \n    return container;\n  }\n\n  setupEventListeners() {\n    const textarea = this.getTextarea();\n    const form = this.getForm();\n    const inputContainer = this.element.querySelector('.chat-input__container');\n    \n    // Store event handlers for cleanup with proper this binding\n    this.handlers = {\n      input: this.autoResize.bind(this),\n      keydown: (e) => {\n        if (e.key === 'Enter' && !e.shiftKey) {\n          e.preventDefault();\n          this.handleSubmit();\n        }\n      },\n      submit: (e) => {\n        e.preventDefault();\n        this.handleSubmit();\n      },\n      containerClick: (e) => {\n        // Don't interfere if user clicks the send button\n        if (!e.target.closest('.chat-input__send')) {\n          // On desktop, prevent scroll when focusing via container click\n          if (!this.isMobileLike()) {\n            try {\n              textarea.focus({ preventScroll: true });\n            } catch (err) {\n              textarea.focus();\n            }\n          } else {\n            textarea.focus();\n          }\n        }\n      },\n      focus: () => {\n        // Small delay to ensure keyboard animation has started\n        setTimeout(() => {\n          // Only auto-scroll on mobile/tablet form factors\n          if (this.isMobileLike() && textarea && textarea.scrollIntoView) {\n            textarea.scrollIntoView({ behavior: 'smooth', block: 'end' });\n          }\n        }, 100);\n      }\n    };\n\n    // Auto-resize textarea\n    textarea.addEventListener('input', this.handlers.input);\n\n    // Handle keyboard shortcuts\n    textarea.addEventListener('keydown', this.handlers.keydown);\n\n    // Desktop-only: prevent default mouse focus scroll and apply preventScroll focus\n    textarea.addEventListener('mousedown', (e) => {\n      if (!this.isMobileLike()) {\n        e.preventDefault();\n        try {\n          textarea.focus({ preventScroll: true });\n        } catch (err) {\n          textarea.focus();\n        }\n      }\n    });\n    \n    // Handle form submission\n    form.addEventListener('submit', this.handlers.submit);\n    \n    // Make entire input container clickable to focus textarea\n    inputContainer.addEventListener('click', this.handlers.containerClick);\n    \n    // Handle virtual keyboard on mobile - ensure input stays visible\n    textarea.addEventListener('focus', this.handlers.focus);\n  }\n\n  autoResize() {\n    const textarea = this.getTextarea();\n    textarea.style.height = 'auto';\n    const maxHeight = 120; // ~5 lines\n    const newHeight = Math.min(textarea.scrollHeight, maxHeight);\n    textarea.style.height = newHeight + 'px';\n  }\n\n  handleSubmit() {\n    if (this.isDisabled) return;\n    \n    // Guard against destroyed state\n    if (!this.onSendMessage || !this.element) return;\n    \n    const textarea = this.getTextarea();\n    if (!textarea) return;\n    \n    const message = textarea.value.trim();\n    \n    if (message && this.onSendMessage) {\n      this.onSendMessage(message);\n      textarea.value = '';\n      this.autoResize();\n    }\n  }\n\n\n  disable() {\n    this.isDisabled = true;\n    const textarea = this.getTextarea();\n    const button = this.getSendButton();\n    \n    textarea.disabled = true;\n    button.disabled = true;\n    this.element.classList.add('chat-input--disabled');\n  }\n\n  enable() {\n    this.isDisabled = false;\n    const textarea = this.getTextarea();\n    const button = this.getSendButton();\n    \n    textarea.disabled = false;\n    button.disabled = false;\n    this.element.classList.remove('chat-input--disabled');\n  }\n\n  focus() {\n    const textarea = this.getTextarea();\n    if (!textarea) return;\n    // On desktop, focus without scrolling the page\n    if (!this.isMobileLike()) {\n      try {\n        textarea.focus({ preventScroll: true });\n      } catch (err) {\n        textarea.focus();\n      }\n    } else {\n      textarea.focus();\n    }\n  }\n\n  getTextarea() {\n    return this.element.querySelector('.chat-input__textarea');\n  }\n\n  getSendButton() {\n    return this.element.querySelector('.chat-input__send');\n  }\n\n  getForm() {\n    return this.element.querySelector('.chat-input__form');\n  }\n\n  getSendIcon() {\n    return `\n      <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\n        <polygon points=\"22,2 15,22 11,13 2,9 22,2\"></polygon>\n      </svg>\n    `;\n  }\n\n  getElement() {\n    return this.element;\n  }\n\n  // Helper to detect mobile/tablet where auto-scroll-on-focus is desirable\n  isMobileLike() {\n    try {\n      return (\n        window.matchMedia && (\n          window.matchMedia('(pointer: coarse)').matches ||\n          window.matchMedia('(max-width: 768px)').matches\n        )\n      );\n    } catch (e) {\n      // Fallback to user agent heuristic only if matchMedia fails\n      const ua = navigator.userAgent || '';\n      return /Mobi|Android|iPad|iPhone|iPod/i.test(ua);\n    }\n  }\n\n  destroy() {\n    // Prevent callbacks from being called after destroy\n    this.onSendMessage = null;\n    \n    // Remove event listeners if they exist\n    if (this.handlers) {\n      const textarea = this.getTextarea();\n      const form = this.getForm();\n      const inputContainer = this.element.querySelector('.chat-input__container');\n      \n      if (textarea) {\n        textarea.removeEventListener('input', this.handlers.input);\n        textarea.removeEventListener('keydown', this.handlers.keydown);\n        textarea.removeEventListener('focus', this.handlers.focus);\n      }\n      \n      if (form) {\n        form.removeEventListener('submit', this.handlers.submit);\n      }\n      \n      if (inputContainer) {\n        inputContainer.removeEventListener('click', this.handlers.containerClick);\n      }\n    }\n    \n    // Clear references\n    this.handlers = null;\n    this.element = null;\n  }\n}\n","export class HistoryAPI {\n  constructor(config) {\n    this.config = config;\n    this.baseUrl = this.getBaseUrl();\n  }\n\n  getBaseUrl() {\n    const apiEndpoint = this.config.apiEndpoint || 'https://leadgate-backend-production.up.railway.app/chat';\n    // Extract base URL by removing '/chat' if present\n    return apiEndpoint.replace('/chat', '');\n  }\n\n  async getConversationHistory() {\n    const endpoint = `${this.baseUrl}/get-session-history`;\n    \n    const payload = {\n      sessionId: this.config.sessionId,\n      clientId: this.config.clientId\n    };\n\n    try {\n      const headers = {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      };\n\n      if (this.config.siteKey) {\n        headers['x-site-key'] = this.config.siteKey;\n        console.log('ChatbotWidget: Fetching history with x-site-key:', this.config.siteKey);\n      } else {\n        console.warn('ChatbotWidget: No site key found in config for history request');\n      }\n\n      console.log('ChatbotWidget: Fetching conversation history for session:', this.config.sessionId);\n\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(payload)\n      });\n\n      if (!response.ok) {\n        // Handle 404 or similar - probably no conversation history exists yet\n        if (response.status === 404) {\n          console.log('ChatbotWidget: No conversation history found for session (404)');\n          return [];\n        }\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      \n      // Validate response format - expecting [{\"sender\":\"user|ai\", \"content\":\"...\"}]\n      if (!Array.isArray(data)) {\n        console.warn('ChatbotWidget: Expected array response, got:', typeof data);\n        return [];\n      }\n\n      console.log('ChatbotWidget: Loaded', data.length, 'messages from conversation history');\n      return data;\n\n    } catch (error) {\n      console.error('ChatbotWidget: Failed to fetch conversation history:', error);\n      \n      // Return empty array on error - widget should still work without history\n      return [];\n    }\n  }\n}","import { Message } from './message.js';\nimport { ChatInput } from './chat-input.js';\nimport { HistoryAPI } from '../utils/history-api.js';\n\nexport class ChatUI {\n  constructor(shadowWrapper, config, chatAPI) {\n    this.shadowWrapper = shadowWrapper;\n    this.config = config;\n    this.chatAPI = chatAPI;\n    this.messages = [];\n    this.isAtBottom = true;\n    this.intersectionObserver = null;\n    \n    // Initialize history API for backend-based conversation history\n    this.historyAPI = new HistoryAPI(config);\n    \n    this.createElement();\n    this.setupScrollObserver();\n    this.applyTheme();\n    \n    // Add entrance animation and focus input\n    requestAnimationFrame(() => {\n      this.container.classList.add('chatbot-widget--visible');\n    });\n    \n    // Do not auto-focus the input on initialization to avoid page auto-scroll\n\n    // Setup mobile viewport/keyboard behavior\n    this.setupMobileViewportHandlers();\n    \n    // Show greeting if no history will be injected\n    if (!config.skipGreeting) {\n      this.showGreeting();\n    }\n  }\n\n  createElement() {\n    const container = document.createElement('div');\n    container.className = 'chatbot-widget';\n    container.setAttribute('role', 'dialog');\n    container.setAttribute('aria-label', 'Chat conversation');\n    \n    // Header\n    const header = document.createElement('div');\n    header.className = 'chatbot-widget__header';\n    \n    // Check if this is a floating widget\n    const isFloating = this.config.container && this.config.container === '#chatbot-widget-container';\n    \n    header.innerHTML = `\n      <h2 class=\"chatbot-widget__title\">Contact us</h2>\n      ${isFloating ? `\n        <button class=\"chatbot-widget__collapse-btn\" title=\"Minimize\" aria-label=\"Minimize chat\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M2 8H14\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n          </svg>\n        </button>\n      ` : ''}\n    `;\n    \n    // Messages container\n    const messagesContainer = document.createElement('div');\n    messagesContainer.className = 'chatbot-widget__messages';\n    messagesContainer.setAttribute('aria-live', 'polite');\n    messagesContainer.setAttribute('aria-label', 'Chat messages');\n    \n    // Input\n    this.chatInput = new ChatInput((message) => this.sendMessage(message));\n    \n    // Error toast\n    this.errorToast = this.createErrorToast();\n    \n    container.appendChild(header);\n    container.appendChild(messagesContainer);\n    container.appendChild(this.chatInput.getElement());\n    container.appendChild(this.errorToast);\n    \n    this.shadowWrapper.appendChild(container);\n    this.container = container;\n    this.messagesContainer = messagesContainer;\n    \n    // Setup floating widget functionality if needed\n    if (isFloating) {\n      this.setupFloatingWidget();\n    }\n    \n    // Widget is now ready for history injection if needed\n  }\n\n  injectHistory(history) {\n    // Clear any existing messages first\n    this.clearMessages();\n    \n    // Validate and process each message in the history\n    if (history.length > 0) {\n      history.forEach((msgData, index) => {\n        if (msgData && msgData.content && msgData.sender && msgData.content.trim()) {\n          // Map 'ai' sender from backend to 'bot' for UI consistency\n          const uiSender = msgData.sender === 'ai' ? 'bot' : msgData.sender;\n          const message = new Message(msgData.content, uiSender);\n          this.addMessageToUI(message);\n        }\n      });\n      \n      // Scroll to bottom after injecting history\n      setTimeout(() => {\n        this.scrollToBottom();\n      }, 50);\n    }\n  }\n  \n  clearMessages() {\n    // Remove all messages from the UI\n    this.messages.forEach(message => {\n      const element = message.getElement();\n      if (element && element.parentNode) {\n        element.parentNode.removeChild(element);\n      }\n    });\n    \n    // Clear the messages array\n    this.messages = [];\n  }\n\n  createErrorToast() {\n    const toast = document.createElement('div');\n    toast.className = 'error-toast';\n    toast.setAttribute('role', 'alert');\n    toast.setAttribute('aria-live', 'assertive');\n    \n    const message = document.createElement('span');\n    message.className = 'error-toast__message';\n    \n    const retryButton = document.createElement('button');\n    retryButton.className = 'error-toast__retry';\n    retryButton.textContent = 'Retry';\n    retryButton.addEventListener('click', () => this.hideErrorToast());\n    \n    const closeButton = document.createElement('button');\n    closeButton.className = 'error-toast__close';\n    closeButton.innerHTML = '×';\n    closeButton.setAttribute('aria-label', 'Close error');\n    closeButton.addEventListener('click', () => this.hideErrorToast());\n    \n    toast.appendChild(message);\n    toast.appendChild(retryButton);\n    toast.appendChild(closeButton);\n    \n    return toast;\n  }\n\n  setupScrollObserver() {\n    // Create a sentinel element at the bottom of messages\n    const sentinel = document.createElement('div');\n    sentinel.className = 'scroll-sentinel';\n    this.messagesContainer.appendChild(sentinel);\n    \n    this.intersectionObserver = new IntersectionObserver(\n      (entries) => {\n        entries.forEach(entry => {\n          this.isAtBottom = entry.isIntersecting;\n        });\n      },\n      { threshold: 0.1 }\n    );\n    \n    this.intersectionObserver.observe(sentinel);\n  }\n\n  setupMobileViewportHandlers() {\n    const textarea = this.chatInput && this.chatInput.getTextarea ? this.chatInput.getTextarea() : null;\n    if (!textarea) return;\n\n    // Track visual viewport changes while the input is focused on mobile/tablet\n    this._vvHandlers = {\n      onFocus: () => {\n        if (!this.isMobileLike()) return;\n        this.enableViewportTracking();\n        // Ensure latest messages are visible when keyboard opens\n        this.scrollToBottom();\n        // Run again after keyboard animation\n        setTimeout(() => this.scrollToBottom(), 250);\n      },\n      onBlur: () => {\n        if (!this.isMobileLike()) return;\n        this.disableViewportTracking();\n      }\n    };\n\n    textarea.addEventListener('focus', this._vvHandlers.onFocus);\n    textarea.addEventListener('blur', this._vvHandlers.onBlur);\n  }\n\n  enableViewportTracking() {\n    const vv = window.visualViewport;\n    const apply = () => {\n      const h = vv && vv.height ? vv.height : window.innerHeight;\n      // Constrain to positive values\n      const height = Math.max(320, Math.floor(h));\n      this.container.style.setProperty('--vvh', height + 'px');\n    };\n    // Save listeners so we can remove them\n    this._vvApply = apply;\n    // Add class to enable CSS that uses --vvh\n    this.container.classList.add('chatbot-widget--vvh');\n    apply();\n    if (vv) {\n      vv.addEventListener('resize', apply);\n      vv.addEventListener('scroll', apply);\n    } else {\n      // Fallback: listen to window resize\n      window.addEventListener('resize', apply);\n    }\n  }\n\n  disableViewportTracking() {\n    const vv = window.visualViewport;\n    if (this._vvApply) {\n      if (vv) {\n        vv.removeEventListener('resize', this._vvApply);\n        vv.removeEventListener('scroll', this._vvApply);\n      } else {\n        window.removeEventListener('resize', this._vvApply);\n      }\n    }\n    this._vvApply = null;\n    // Clear custom height so layout returns to normal\n    this.container.style.removeProperty('--vvh');\n    this.container.classList.remove('chatbot-widget--vvh');\n  }\n\n  isMobileLike() {\n    try {\n      return (\n        (window.matchMedia && window.matchMedia('(pointer: coarse)').matches) ||\n        (window.matchMedia && window.matchMedia('(max-width: 768px)').matches)\n      );\n    } catch (e) {\n      const ua = navigator.userAgent || '';\n      return /Mobi|Android|iPad|iPhone|iPod/i.test(ua);\n    }\n  }\n\n  async sendMessage(messageText) {\n    // Guard against destroyed state\n    if (!this.chatInput) {\n      console.warn('ChatUI has been destroyed, cannot send message');\n      return;\n    }\n    \n    try {\n      // Add user message to UI\n      const userMessage = new Message(messageText, 'user');\n      this.addMessage(userMessage);\n      \n      // Create loading bot message immediately\n      const loadingBotMessage = Message.createLoadingMessage();\n      this.addMessage(loadingBotMessage);\n      \n      // Disable input and scroll to bottom\n      if (this.chatInput) {\n        this.chatInput.disable();\n      }\n      this.scrollToBottom();\n      \n      // Send to API (backend handles persistence)\n      const response = await this.chatAPI.sendMessage(messageText);\n      \n      // Update the loading message with actual content\n      loadingBotMessage.updateContent(response.content);\n      \n      // That's it! Backend handles all persistence, no client-side saving needed\n      \n    } catch (error) {\n      // Remove the loading message and show error\n      this.removeLastMessage();\n      this.showErrorToast(error.message);\n    } finally {\n      if (this.chatInput) {\n        this.chatInput.enable();\n        this.chatInput.focus();\n      }\n    }\n  }\n\n  addMessage(message) {\n    // Add new message to UI (for real-time messages)\n    this.addMessageToUI(message);\n  }\n\n  addMessageToUI(message) {\n    // Simply add message to UI without any persistence logic\n    console.log('ChatbotWidget: addMessageToUI called with message:', message);\n    console.log('ChatbotWidget: Current messages array length before add:', this.messages.length);\n    console.log('ChatbotWidget: Messages container exists:', !!this.messagesContainer);\n    \n    this.messages.push(message);\n    \n    const messageElement = message.getElement();\n    console.log('ChatbotWidget: Got message element:', messageElement);\n    console.log('ChatbotWidget: Messages container children before insert:', this.messagesContainer.children.length);\n    \n    this.messagesContainer.insertBefore(\n      messageElement,\n      this.messagesContainer.lastElementChild // Insert before sentinel\n    );\n    \n    console.log('ChatbotWidget: Messages container children after insert:', this.messagesContainer.children.length);\n    console.log('ChatbotWidget: Current messages array length after add:', this.messages.length);\n    \n    if (this.isAtBottom) {\n      console.log('ChatbotWidget: Scrolling to bottom');\n      this.scrollToBottom();\n    }\n  }\n\n  removeLastMessage() {\n    if (this.messages.length > 0) {\n      const lastMessage = this.messages.pop();\n      const lastElement = lastMessage.getElement();\n      if (lastElement && lastElement.parentNode) {\n        lastElement.parentNode.removeChild(lastElement);\n      }\n    }\n  }\n\n  scrollToBottom() {\n    const container = this.messagesContainer;\n    container.scrollTop = container.scrollHeight;\n  }\n\n  showErrorToast(message) {\n    const messageElement = this.errorToast.querySelector('.error-toast__message');\n    messageElement.textContent = message;\n    this.errorToast.classList.add('error-toast--visible');\n    \n    // Auto-hide after 5 seconds\n    setTimeout(() => this.hideErrorToast(), 5000);\n  }\n\n  hideErrorToast() {\n    this.errorToast.classList.remove('error-toast--visible');\n  }\n\n  applyTheme() {\n    const theme = this.config.theme;\n    if (theme === 'dark') {\n      this.container.classList.add('chatbot-widget--dark');\n    } else if (theme === 'light') {\n      this.container.classList.add('chatbot-widget--light');\n    } else if (typeof theme === 'string' && theme.startsWith('#')) {\n      // Custom theme color - generate a complete theme palette\n      this.applyCustomTheme(theme);\n    }\n  }\n\n  applyCustomTheme(primaryColor) {\n    // Generate complementary colors for the custom theme\n    const customTheme = this.generateCustomTheme(primaryColor, this.config.themeMode);\n    \n    // Apply all the custom theme variables\n    Object.entries(customTheme).forEach(([property, value]) => {\n      this.container.style.setProperty(property, value);\n    });\n  }\n\n  generateCustomTheme(primaryColor, explicitMode = null) {\n    // Parse the hex color to RGB\n    const rgb = this.hexToRgb(primaryColor);\n    \n    // Determine if we should use light or dark theme\n    let isLight;\n    if (explicitMode) {\n      // Use explicit mode if provided\n      isLight = explicitMode === 'light';\n    } else {\n      // Fall back to auto-detection based on luminance\n      const luminance = this.calculateLuminance(rgb.r, rgb.g, rgb.b);\n      isLight = luminance > 0.5;\n    }\n    \n    // Generate hover color (slightly darker for light themes, lighter for dark themes)\n    const hoverColor = this.adjustBrightness(primaryColor, isLight ? -0.15 : 0.15);\n    \n    // Generate theme colors with good contrast\n    return {\n      '--primary-color': primaryColor,\n      '--primary-hover': hoverColor,\n      '--background-color': isLight ? '#ffffff' : '#1a1a1a',\n      '--surface-color': isLight ? '#f8f9fa' : '#2d2d2d',\n      '--text-primary': isLight ? '#1a1a1a' : '#ffffff',\n      '--text-secondary': isLight ? '#6c757d' : '#b0b0b0',\n      '--border-color': isLight ? '#e9ecef' : '#404040',\n      '--shadow-light': isLight ? '0 2px 8px rgba(0, 0, 0, 0.1)' : '0 2px 8px rgba(0, 0, 0, 0.3)',\n      '--shadow-medium': isLight ? '0 4px 16px rgba(0, 0, 0, 0.15)' : '0 4px 16px rgba(0, 0, 0, 0.4)'\n    };\n  }\n\n  hexToRgb(hex) {\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    return result ? {\n      r: parseInt(result[1], 16),\n      g: parseInt(result[2], 16),\n      b: parseInt(result[3], 16)\n    } : null;\n  }\n\n  calculateLuminance(r, g, b) {\n    // Convert RGB to relative luminance\n    const [rs, gs, bs] = [r, g, b].map(c => {\n      c = c / 255;\n      return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);\n    });\n    return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;\n  }\n\n  adjustBrightness(hex, factor) {\n    const rgb = this.hexToRgb(hex);\n    if (!rgb) return hex;\n    \n    const adjust = (value) => {\n      const adjusted = Math.round(value * (1 + factor));\n      return Math.max(0, Math.min(255, adjusted));\n    };\n    \n    const r = adjust(rgb.r);\n    const g = adjust(rgb.g);\n    const b = adjust(rgb.b);\n    \n    return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;\n  }\n\n  async loadConversationHistory() {\n    try {\n      const history = await this.historyAPI.getConversationHistory();\n      \n      if (history.length > 0) {\n        // Add each message from history\n        history.forEach((msgData, index) => {\n          if (msgData && msgData.content && msgData.sender && msgData.content.trim()) {\n            // Map 'ai' sender from backend to 'bot' for UI consistency\n            const uiSender = msgData.sender === 'ai' ? 'bot' : msgData.sender;\n            const message = new Message(msgData.content, uiSender);\n            this.addMessageToUI(message); // Add to UI without saving (already saved on backend)\n          }\n        });\n        \n        // Scroll to bottom after loading messages\n        this.scrollToBottom();\n      } else {\n        // No history, show greeting\n        this.showGreeting();\n      }\n    } catch (error) {\n      console.error('ChatbotWidget: Failed to load conversation history:', error);\n      // Still show greeting even if history fails\n      this.showGreeting();\n    }\n  }\n\n  showGreeting() {\n    if (this.config.greetingMessage && this.messages.length === 0) {\n      const greetingMessage = new Message(this.config.greetingMessage, 'bot');\n      this.addMessageToUI(greetingMessage); // Add to UI only, don't save greeting\n    }\n  }\n\n  setupFloatingWidget() {\n    // Setup collapse functionality\n    const collapseBtn = this.container.querySelector('.chatbot-widget__collapse-btn');\n    if (collapseBtn) {\n      collapseBtn.addEventListener('click', () => this.collapseWidget());\n    }\n\n    // Setup collapsed button functionality\n    const collapsedContainer = document.getElementById('chatbot-widget-collapsed');\n    if (collapsedContainer) {\n      const expandBtn = collapsedContainer.querySelector('.chatbot-collapsed-button');\n      const closeBtn = collapsedContainer.querySelector('.chatbot-close-button');\n      \n      if (expandBtn) {\n        expandBtn.addEventListener('click', () => this.expandWidget());\n      }\n      \n      if (closeBtn) {\n        closeBtn.addEventListener('click', () => this.closeWidget());\n      }\n    }\n\n    // Handle initial state with persistence\n    this.applyStoredState();\n  }\n\n  collapseWidget(saveState = true) {\n    const widgetContainer = document.getElementById('chatbot-widget-container');\n    const collapsedContainer = document.getElementById('chatbot-widget-collapsed');\n    \n    if (widgetContainer && collapsedContainer) {\n      widgetContainer.style.display = 'none';\n      collapsedContainer.style.display = 'flex';\n      if (saveState) {\n        this.saveWidgetState('collapsed');\n      }\n    }\n  }\n\n  expandWidget(saveState = true) {\n    const widgetContainer = document.getElementById('chatbot-widget-container');\n    const collapsedContainer = document.getElementById('chatbot-widget-collapsed');\n    \n    if (widgetContainer && collapsedContainer) {\n      collapsedContainer.style.display = 'none';\n      widgetContainer.style.display = 'block';\n      if (saveState) {\n        this.saveWidgetState('expanded');\n      }\n    }\n  }\n\n  closeWidget(saveState = true) {\n    const widgetContainer = document.getElementById('chatbot-widget-container');\n    const collapsedContainer = document.getElementById('chatbot-widget-collapsed');\n    \n    if (widgetContainer && collapsedContainer) {\n      widgetContainer.style.display = 'none';\n      collapsedContainer.style.display = 'none';\n      if (saveState) {\n        this.saveWidgetState('closed');\n      }\n    }\n  }\n\n  saveWidgetState(state) {\n    try {\n      const stateKey = this.getWidgetStateKey();\n      localStorage.setItem(stateKey, state);\n    } catch (error) {\n      console.warn('Failed to save widget state:', error);\n    }\n  }\n\n  getStoredWidgetState() {\n    try {\n      const stateKey = this.getWidgetStateKey();\n      return localStorage.getItem(stateKey);\n    } catch (error) {\n      console.warn('Failed to get stored widget state:', error);\n      return null;\n    }\n  }\n\n  getWidgetStateKey() {\n    // Create a unique key based on site key or domain to avoid conflicts\n    const siteKey = this.config.siteKey || 'default';\n    const domain = window.location.hostname;\n    return `chatbot-widget-state-${siteKey}-${domain}`;\n  }\n\n  applyStoredState() {\n    // Check if state was already determined by the inline script\n    if (window.__chatbotInitialState) {\n      const presetState = window.__chatbotInitialState;\n      \n      // The state has already been applied via inline script\n      // We just need to ensure our internal state tracking is correct\n      // and save if needed\n      \n      // Save the state if it wasn't already stored\n      const storedState = this.getStoredWidgetState();\n      if (!storedState && presetState) {\n        this.saveWidgetState(presetState);\n      }\n      \n      // Clean up the global variable\n      delete window.__chatbotInitialState;\n      return;\n    }\n    \n    // Fallback for non-WordPress implementations or if something went wrong\n    const storedState = this.getStoredWidgetState();\n    const defaultState = this.config.floatingDefaultState || 'expanded';\n    \n    // Prioritize stored state over default state\n    const finalState = storedState || defaultState;\n    \n    // Apply immediately without delay\n    switch (finalState) {\n      case 'collapsed':\n        this.collapseWidget(false); // Don't save state during initialization\n        break;\n      case 'closed':\n        this.closeWidget(false); // Don't save state during initialization\n        break;\n      case 'expanded':\n      default:\n        this.expandWidget(false); // Don't save state during initialization\n        break;\n    }\n    \n    // Save the initial state only if there was no stored state\n    // This ensures first-time visitors get the default state saved\n    if (!storedState) {\n      this.saveWidgetState(finalState);\n    }\n  }\n\n  destroy() {\n    // Clean up mobile viewport handlers\n    try {\n      this.disableViewportTracking();\n    } catch (e) {}\n    const textarea = this.chatInput && this.chatInput.getTextarea ? this.chatInput.getTextarea() : null;\n    if (textarea && this._vvHandlers) {\n      textarea.removeEventListener('focus', this._vvHandlers.onFocus);\n      textarea.removeEventListener('blur', this._vvHandlers.onBlur);\n    }\n\n    if (this.intersectionObserver) {\n      this.intersectionObserver.disconnect();\n    }\n    \n    // Properly destroy chat input before nullifying\n    if (this.chatInput && typeof this.chatInput.destroy === 'function') {\n      this.chatInput.destroy();\n    }\n    \n    // Clean up references\n    this.chatInput = null;\n    this.messages = [];\n    this.chatAPI = null;\n    this.historyAPI = null;\n    this.config = null;\n    this.shadowWrapper = null;\n  }\n}\n","import { ShadowDOMWrapper } from './utils/shadow-dom.js';\nimport { generateUUID } from './utils/uuid.js';\nimport { ChatAPI } from './utils/chat-api.js';\nimport { ChatUI } from './components/chat-ui.js';\nimport { injectStyles } from './utils/styles.js';\n\nexport class ChatbotWidget {\n  constructor() {\n    this.isInitialized = false;\n    this.shadowWrapper = null;\n    this.chatAPI = null;\n    this.chatUI = null;\n    this.config = null;\n  }\n\n  init(config) {\n    // If already initialized, unmount first\n    if (this.isInitialized) {\n      console.warn('ChatbotWidget already initialized, reinitializing...');\n      this.unmount();\n    }\n\n    // Generate or use provided sessionId\n    const sessionId = config.sessionId || this.getOrCreateSessionId(config.siteKey);\n    \n    // Override sessionId in config with the managed sessionId\n    const configWithSession = {\n      ...config,\n      sessionId: sessionId,\n      skipGreeting: !!config.history // Skip greeting if history will be injected\n    };\n\n    this.config = this.validateConfig(configWithSession);\n    \n    try {\n      this.shadowWrapper = new ShadowDOMWrapper(this.config.container);\n      injectStyles(this.shadowWrapper.shadowRoot);\n      \n      this.chatAPI = new ChatAPI(this.config);\n      this.chatUI = new ChatUI(this.shadowWrapper, this.config, this.chatAPI);\n      \n      this.setupEventListeners();\n      this.isInitialized = true;\n      \n      // Inject history if provided\n      if (config.history && Array.isArray(config.history)) {\n        this.injectHistory(config.history);\n      }\n      \n      console.log('ChatbotWidget initialized successfully with sessionId:', this.config.sessionId);\n    } catch (error) {\n      console.error('Failed to initialize ChatbotWidget:', error);\n      throw error;\n    }\n  }\n\n  getOrCreateSessionId(siteKey) {\n    const sessionKey = `chatbot-session-${siteKey}`;\n    \n    try {\n      // Check if we already have a sessionId in sessionStorage\n      let sessionId = sessionStorage.getItem(sessionKey);\n      \n      if (!sessionId) {\n        // Generate new UUID sessionId\n        sessionId = generateUUID();\n        sessionStorage.setItem(sessionKey, sessionId);\n        console.log('ChatbotWidget: New session created:', sessionId);\n      } else {\n        console.log('ChatbotWidget: Existing session restored:', sessionId);\n      }\n      \n      return sessionId;\n    } catch (error) {\n      console.warn('ChatbotWidget: Failed to access sessionStorage, using temporary session:', error);\n      // Fallback to temporary sessionId if sessionStorage is not available\n      return generateUUID();\n    }\n  }\n\n  validateConfig(config) {\n    if (!config) {\n      throw new Error('Configuration is required');\n    }\n\n    const required = ['clientId', 'container'];\n    for (const field of required) {\n      if (!config[field]) {\n        throw new Error(`Missing required config field: ${field}`);\n      }\n    }\n\n    if (!config.siteKey) {\n      throw new Error('Site key is required. Please include site-key attribute in the script tag.');\n    }\n\n    // Validate themeMode if provided\n    if (config.themeMode && !['light', 'dark'].includes(config.themeMode)) {\n      throw new Error('themeMode must be either \"light\" or \"dark\"');\n    }\n\n    return {\n      clientId: config.clientId,\n      sessionId: config.sessionId || generateUUID(),\n      container: config.container,\n      theme: config.theme || 'light',\n      themeMode: config.themeMode, // Optional: 'light' or 'dark' for custom themes\n      locale: config.locale || 'en',\n      apiEndpoint: config.apiEndpoint || 'https://leadgate-backend-production.up.railway.app/chat',\n      greetingMessage: config.greetingMessage || 'Hi, I how can I help you?',\n      siteKey: config.siteKey\n    };\n  }\n\n  setupEventListeners() {\n    window.addEventListener('beforeunload', () => {\n      this.unmount();\n    });\n  }\n\n  send(message) {\n    if (!this.isInitialized) {\n      throw new Error('Widget not initialized. Call init() first.');\n    }\n\n    if (!message || typeof message !== 'string') {\n      throw new Error('Message must be a non-empty string');\n    }\n\n    this.chatUI.sendMessage(message);\n  }\n\n  injectHistory(history) {\n    if (!this.isInitialized) {\n      throw new Error('Widget not initialized. Call init() first.');\n    }\n\n    if (!Array.isArray(history)) {\n      throw new Error('History must be an array of message objects');\n    }\n\n    this.chatUI.injectHistory(history);\n  }\n\n\n  unmount() {\n    if (!this.isInitialized) {\n      return;\n    }\n\n    try {\n      if (this.chatUI) {\n        this.chatUI.destroy();\n      }\n      \n      if (this.shadowWrapper) {\n        this.shadowWrapper.destroy();\n      }\n\n      this.isInitialized = false;\n      this.shadowWrapper = null;\n      this.chatAPI = null;\n      this.chatUI = null;\n      this.config = null;\n\n      console.log('ChatbotWidget unmounted successfully');\n    } catch (error) {\n      console.error('Error during unmount:', error);\n    }\n  }\n}","// Inline the styles directly for now to debug the issue\nconst styles = `\n:root {\n  --primary-color: #0066cc;\n  --primary-hover: #0052a3;\n  --background-color: #ffffff;\n  --surface-color: #f1f3f4;\n  --text-primary: #202124;\n  --text-secondary: #5f6368;\n  --border-color: #e8eaed;\n  --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.1);\n  --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.15);\n  --border-radius: 8px;\n  --border-radius-small: 4px;\n  --transition-fast: 150ms ease;\n  --transition-medium: 250ms ease;\n}\n\n.chatbot-widget--light {\n  --primary-color: #0066cc;\n  --primary-hover: #0052a3;\n  --background-color: #ffffff;\n  --surface-color: #f1f3f4;\n  --text-primary: #202124;\n  --text-secondary: #5f6368;\n  --border-color: #e8eaed;\n}\n\n.chatbot-widget--dark {\n  --primary-color: #007aff;\n  --primary-hover: #0056cc;\n  --background-color: #1c1c1e;\n  --surface-color: #2c2c2e;\n  --text-primary: #ffffff;\n  --text-secondary: #8e8e93;\n  --border-color: #3a3a3c;\n  --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.4);\n  --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.6);\n}\n\n.chatbot-widget {\n  width: 100%;\n  height: 100%;\n  min-height: 400px;\n  display: flex;\n  flex-direction: column;\n  background-color: var(--background-color);\n  border-radius: var(--border-radius);\n  box-shadow: var(--shadow-medium);\n  overflow: hidden;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  font-size: 14px;\n  line-height: 1.5;\n  color: var(--text-primary);\n  opacity: 0;\n  transform: translateY(20px);\n  transition: opacity var(--transition-medium), transform var(--transition-medium);\n}\n\n.chatbot-widget--visible {\n  opacity: 1;\n  transform: translateY(0);\n}\n\n.chatbot-widget__header {\n  padding: 1rem;\n  background-color: var(--primary-color);\n  color: white;\n  text-align: center;\n  border-bottom: 1px solid var(--border-color);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  position: relative;\n}\n\n.chatbot-widget__title {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  flex: 1;\n  text-align: center;\n}\n\n.chatbot-widget__collapse-btn {\n  background: none;\n  border: none;\n  color: white;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  transition: var(--transition-fast);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  position: absolute;\n  right: 12px;\n}\n\n.chatbot-widget__collapse-btn:hover {\n  background-color: rgba(255, 255, 255, 0.1);\n}\n\n.chatbot-widget__collapse-btn:focus {\n  outline: 2px solid rgba(255, 255, 255, 0.5);\n  outline-offset: 2px;\n}\n\n.chatbot-widget__messages {\n  flex: 1;\n  overflow-y: auto;\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  scroll-behavior: smooth;\n}\n\n.message {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  max-width: 75%;\n  margin-bottom: 0.5rem;\n  opacity: 0;\n  transform: scale(0.95) translateY(10px);\n  animation: messageEnter 150ms ease forwards;\n}\n\n.message--user {\n  align-self: flex-end;\n  align-items: flex-end;\n  margin-left: 20%;\n}\n\n.message--bot {\n  align-self: flex-start;\n  align-items: flex-start;\n  margin-right: 20%;\n}\n\n.message__content {\n  padding: 0.625rem 0.875rem;\n  border-radius: 18px;\n  word-wrap: break-word;\n  position: relative;\n  font-size: 14px;\n  line-height: 1.4;\n  transition: opacity 150ms ease;\n}\n\n.message__content .typing-dots {\n  display: flex;\n  gap: 0.25rem;\n  align-items: center;\n  justify-content: center;\n  min-height: 20px;\n}\n\n.message__content .typing-dot {\n  width: 6px;\n  height: 6px;\n  background-color: var(--text-secondary);\n  border-radius: 50%;\n  animation: typingPulse 1.4s infinite ease-in-out both;\n}\n\n.message__content .typing-dot:nth-child(1) { animation-delay: -0.32s; }\n.message__content .typing-dot:nth-child(2) { animation-delay: -0.16s; }\n.message__content .typing-dot:nth-child(3) { animation-delay: 0s; }\n\n.message--user .message__content {\n  background-color: var(--primary-color);\n  color: #ffffff !important;\n  border-bottom-right-radius: 4px;\n  position: relative;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n\n.message--user .message__content::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  right: -8px;\n  width: 0;\n  height: 0;\n  border: 8px solid transparent;\n  border-left-color: var(--primary-color);\n  border-bottom: 0;\n  border-right: 0;\n}\n\n.message--bot .message__content {\n  background-color: var(--surface-color);\n  color: var(--text-primary) !important;\n  border: 1px solid var(--border-color);\n  border-bottom-left-radius: 4px;\n  position: relative;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n}\n\n.message--bot .message__content::before {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: -8px;\n  width: 0;\n  height: 0;\n  border: 8px solid transparent;\n  border-right-color: var(--surface-color);\n  border-bottom: 0;\n  border-left: 0;\n}\n\n.message--bot .message__content::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: -9px;\n  width: 0;\n  height: 0;\n  border: 9px solid transparent;\n  border-right-color: var(--border-color);\n  border-bottom: 0;\n  border-left: 0;\n  z-index: -1;\n}\n\n.message__time {\n  font-size: 0.6875rem;\n  color: var(--text-secondary);\n  padding: 0.125rem 0.25rem;\n  opacity: 0.8;\n  font-weight: 400;\n}\n\n.typing-indicator {\n  display: none;\n  align-items: center;\n  align-self: flex-start;\n  margin-bottom: 0.5rem;\n  max-width: 75%;\n  margin-right: 20%;\n  opacity: 0;\n  transform: scale(0.95) translateY(10px);\n  animation: messageEnter 150ms ease forwards;\n}\n\n.typing-indicator__bubble {\n  background-color: var(--surface-color);\n  border: 1px solid var(--border-color);\n  border-radius: 18px;\n  border-bottom-left-radius: 4px;\n  padding: 0.75rem 1rem;\n  position: relative;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n}\n\n.typing-indicator__bubble::before {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: -8px;\n  width: 0;\n  height: 0;\n  border: 8px solid transparent;\n  border-right-color: var(--surface-color);\n  border-bottom: 0;\n  border-left: 0;\n}\n\n.typing-indicator__bubble::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: -9px;\n  width: 0;\n  height: 0;\n  border: 9px solid transparent;\n  border-right-color: var(--border-color);\n  border-bottom: 0;\n  border-left: 0;\n  z-index: -1;\n}\n\n.chat-input {\n  border-top: 1px solid var(--border-color);\n  background-color: var(--background-color);\n  padding: 0.75rem;\n}\n\n.chat-input--disabled {\n  opacity: 0.6;\n  pointer-events: none;\n}\n\n.chat-input__container {\n  display: flex;\n  gap: 0.5rem;\n  align-items: flex-end;\n}\n\n.chat-input__textarea {\n  flex: 1;\n  min-height: 40px;\n  max-height: 120px;\n  padding: 0.75rem;\n  border: 1px solid var(--border-color);\n  border-radius: var(--border-radius);\n  background-color: var(--surface-color);\n  color: var(--text-primary);\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  resize: none;\n  transition: border-color var(--transition-fast);\n}\n\n.chat-input__textarea:focus {\n  outline: none;\n  border-color: var(--primary-color);\n  box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.2);\n}\n\n.chat-input__textarea::placeholder {\n  color: var(--text-secondary);\n}\n\n.chat-input__send {\n  min-width: 44px;\n  height: 44px;\n  padding: 0.5rem;\n  background-color: var(--primary-color);\n  color: white;\n  border: none;\n  border-radius: var(--border-radius);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: background-color var(--transition-fast);\n}\n\n.chat-input__send:hover:not(:disabled) {\n  background-color: var(--primary-hover);\n}\n\n.chat-input__send:focus {\n  outline: none;\n  box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.3);\n}\n\n.chat-input__send svg {\n  width: 18px;\n  height: 18px;\n}\n\n.error-toast {\n  position: absolute;\n  bottom: 80px;\n  left: 1rem;\n  right: 1rem;\n  background-color: #dc3545;\n  color: white;\n  padding: 0.75rem;\n  border-radius: var(--border-radius);\n  box-shadow: var(--shadow-medium);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  transform: translateY(100%);\n  opacity: 0;\n  transition: transform var(--transition-medium), opacity var(--transition-medium);\n  z-index: 1000;\n}\n\n.error-toast--visible {\n  transform: translateY(0);\n  opacity: 1;\n}\n\n.scroll-sentinel {\n  height: 1px;\n  pointer-events: none;\n}\n\n/* Mobile/tablet responsive adjustments */\n@media (max-width: 768px) {\n  /* Only apply dynamic viewport height when explicitly enabled via class */\n  .chatbot-widget.chatbot-widget--vvh {\n    height: var(--vvh, 100dvh);\n    min-height: var(--vvh, 100dvh);\n  }\n\n  .chatbot-widget__messages {\n    /* Reserve room so latest messages aren’t obscured */\n    padding-bottom: calc(1rem + env(safe-area-inset-bottom));\n  }\n\n  .chat-input {\n    /* Respect safe area when keyboard/home indicator present */\n    padding-bottom: calc(0.75rem + env(safe-area-inset-bottom));\n  }\n}\n\n@keyframes messageEnter {\n  to {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n  }\n}\n\n@keyframes typingPulse {\n  0%, 80%, 100% {\n    transform: scale(0.8);\n    opacity: 0.5;\n  }\n  40% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n`;\n\nexport function injectStyles(shadowRoot) {\n  const styleElement = document.createElement('style');\n  styleElement.textContent = styles;\n  shadowRoot.appendChild(styleElement);\n}\n","import { ChatbotWidget } from './chatbot-widget.js';\n\n// Extract site-key from the current script tag\nfunction getCurrentScriptSiteKey() {\n  // For async scripts, document.currentScript might not be available\n  // So we need to find our script by looking for the one with site-key attribute\n  const scripts = document.querySelectorAll('script[site-key]');\n  \n  // If we have scripts with site-key, use the first one\n  if (scripts.length > 0) {\n    return scripts[0].getAttribute('site-key');\n  }\n  \n  // Fallback to document.currentScript for non-async scripts\n  const currentScript = document.currentScript;\n  if (currentScript) {\n    return currentScript.getAttribute('site-key');\n  }\n  \n  // Last resort: check if there's a script with our widget URL\n  const widgetScripts = document.querySelectorAll('script[src*=\"chatbot-widget.js\"]');\n  for (const script of widgetScripts) {\n    const siteKey = script.getAttribute('site-key');\n    if (siteKey) {\n      return siteKey;\n    }\n  }\n  \n  return null;\n}\n\n// Store multiple widget instances by container\nconst widgets = new Map();\n\nwindow.ChatbotWidget = {\n  init: (config) => {\n    // Use siteKey from config if provided, otherwise try to extract from script tag\n    const scriptSiteKey = getCurrentScriptSiteKey();\n    const siteKey = config.siteKey || scriptSiteKey;\n    \n    if (!siteKey) {\n      console.error('Chatbot Widget: No site-key found. Please provide site-key in config or as script attribute.');\n    }\n    \n    const configWithSiteKey = {\n      ...config,\n      siteKey: siteKey\n    };\n    console.log('Chatbot Widget: Site key:', siteKey ? 'Found' : 'Missing');\n    console.log('Chatbot Widget: Initializing with config:', configWithSiteKey);\n    \n    const container = configWithSiteKey.container;\n    \n    // If widget already exists for this container, unmount it first\n    if (widgets.has(container)) {\n      console.warn('ChatbotWidget already exists for container', container, ', unmounting previous instance');\n      widgets.get(container).unmount();\n    }\n    \n    // Create new widget instance for this container\n    const widget = new ChatbotWidget();\n    widgets.set(container, widget);\n    \n    return widget.init(configWithSiteKey);\n  },\n  send: (message, container = null) => {\n    // If container specified, send to that widget\n    if (container && widgets.has(container)) {\n      return widgets.get(container).send(message);\n    }\n    \n    // Otherwise, send to the first available widget\n    const widget = widgets.values().next().value;\n    if (widget) {\n      return widget.send(message);\n    }\n    \n    throw new Error('No ChatbotWidget instances found');\n  },\n  unmount: (container = null) => {\n    if (container) {\n      // Unmount specific container\n      if (widgets.has(container)) {\n        widgets.get(container).unmount();\n        widgets.delete(container);\n      }\n    } else {\n      // Unmount all widgets\n      for (const [key, widget] of widgets) {\n        widget.unmount();\n      }\n      widgets.clear();\n    }\n  },\n  \n  // Get widget instance for a specific container (for advanced usage)\n  getInstance: (container) => {\n    return widgets.get(container) || null;\n  }\n};"],"names":["ShadowDOMWrapper","constructor","container","this","document","querySelector","Error","shadowRoot","innerHTML","attachShadow","mode","setupStyles","style","createElement","textContent","appendChild","injectStyles","cssText","element","selector","querySelectorAll","destroy","generateUUID","crypto","randomUUID","replace","c","r","Math","random","toString","ChatAPI","config","retryCount","maxRetries","baseDelay","sendMessage","message","payload","sessionId","clientId","content","type","makeRequest","attempt","headers","Accept","siteKey","response","fetch","apiEndpoint","method","body","JSON","stringify","ok","status","statusText","data","json","error","isRetryableError","delay","calculateDelay","sleep","getUserFriendlyError","name","includes","exponentialDelay","pow","jitter","min","ms","Promise","resolve","setTimeout","entries","setPrototypeOf","isFrozen","getPrototypeOf","getOwnPropertyDescriptor","Object","freeze","seal","create","apply","construct","Reflect","x","fun","thisValue","args","Func","arrayForEach","unapply","Array","prototype","forEach","arrayLastIndexOf","lastIndexOf","arrayPop","pop","arrayPush","push","arraySplice","splice","stringToLowerCase","String","toLowerCase","stringToString","stringMatch","match","stringReplace","stringIndexOf","indexOf","stringTrim","trim","objectHasOwnProperty","hasOwnProperty","regExpTest","RegExp","test","typeErrorCreate","func","TypeError","_len2","arguments","length","_key2","thisArg","lastIndex","_len","_key","addToSet","set","array","transformCaseFunc","undefined","l","lcElement","cleanArray","index","clone","object","newObject","property","value","isArray","lookupGetter","prop","desc","get","html$1","svg$1","svgFilters","svgDisallowed","mathMl$1","mathMlDisallowed","text","html","svg","mathMl","xml","MUSTACHE_EXPR","ERB_EXPR","TMPLIT_EXPR","DATA_ATTR","ARIA_ATTR","IS_ALLOWED_URI","IS_SCRIPT_OR_DATA","ATTR_WHITESPACE","DOCTYPE_NAME","CUSTOM_ELEMENT","EXPRESSIONS","__proto__","NODE_TYPE","getGlobal","window","purify","createDOMPurify","DOMPurify","root","version","removed","nodeType","Element","isSupported","originalDocument","currentScript","DocumentFragment","HTMLTemplateElement","Node","NodeFilter","NamedNodeMap","MozNamedAttrMap","HTMLFormElement","DOMParser","trustedTypes","ElementPrototype","cloneNode","remove","getNextSibling","getChildNodes","getParentNode","template","ownerDocument","trustedTypesPolicy","emptyHTML","implementation","createNodeIterator","createDocumentFragment","getElementsByTagName","importNode","hooks","afterSanitizeAttributes","afterSanitizeElements","afterSanitizeShadowDOM","beforeSanitizeAttributes","beforeSanitizeElements","beforeSanitizeShadowDOM","uponSanitizeAttribute","uponSanitizeElement","uponSanitizeShadowNode","createHTMLDocument","IS_ALLOWED_URI$1","ALLOWED_TAGS","DEFAULT_ALLOWED_TAGS","ALLOWED_ATTR","DEFAULT_ALLOWED_ATTR","CUSTOM_ELEMENT_HANDLING","tagNameCheck","writable","configurable","enumerable","attributeNameCheck","allowCustomizedBuiltInElements","FORBID_TAGS","FORBID_ATTR","ALLOW_ARIA_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","ALLOW_SELF_CLOSE_IN_ATTR","SAFE_FOR_TEMPLATES","SAFE_FOR_XML","WHOLE_DOCUMENT","SET_CONFIG","FORCE_BODY","RETURN_DOM","RETURN_DOM_FRAGMENT","RETURN_TRUSTED_TYPE","SANITIZE_DOM","SANITIZE_NAMED_PROPS","KEEP_CONTENT","IN_PLACE","USE_PROFILES","FORBID_CONTENTS","DEFAULT_FORBID_CONTENTS","DATA_URI_TAGS","DEFAULT_DATA_URI_TAGS","URI_SAFE_ATTRIBUTES","DEFAULT_URI_SAFE_ATTRIBUTES","MATHML_NAMESPACE","SVG_NAMESPACE","HTML_NAMESPACE","NAMESPACE","IS_EMPTY_INPUT","ALLOWED_NAMESPACES","DEFAULT_ALLOWED_NAMESPACES","MATHML_TEXT_INTEGRATION_POINTS","HTML_INTEGRATION_POINTS","COMMON_SVG_AND_HTML_ELEMENTS","PARSER_MEDIA_TYPE","SUPPORTED_PARSER_MEDIA_TYPES","CONFIG","formElement","isRegexOrFunction","testValue","Function","_parseConfig","cfg","ADD_URI_SAFE_ATTR","ADD_DATA_URI_TAGS","ALLOWED_URI_REGEXP","ADD_TAGS","ADD_ATTR","table","tbody","TRUSTED_TYPES_POLICY","createHTML","createScriptURL","purifyHostElement","createPolicy","suffix","ATTR_NAME","hasAttribute","getAttribute","policyName","scriptUrl","_","_createTrustedTypesPolicy","ALL_SVG_TAGS","ALL_MATHML_TAGS","_forceRemove","node","removeChild","_removeAttribute","attribute","getAttributeNode","from","removeAttribute","setAttribute","_initDocument","dirty","doc","leadingWhitespace","matches","dirtyPayload","parseFromString","documentElement","createDocument","insertBefore","createTextNode","childNodes","call","_createNodeIterator","SHOW_ELEMENT","SHOW_COMMENT","SHOW_TEXT","SHOW_PROCESSING_INSTRUCTION","SHOW_CDATA_SECTION","_isClobbered","nodeName","attributes","namespaceURI","hasChildNodes","_isNode","_executeHooks","currentNode","hook","_sanitizeElements","tagName","allowedTags","firstElementChild","_isBasicCustomElement","parentNode","i","childClone","__removalCount","parent","parentTagName","Boolean","_checkValidNamespace","expr","_isValidAttribute","lcTag","lcName","_sanitizeAttributes","hookEvent","attrName","attrValue","keepAttr","allowedAttributes","forceKeepAttr","attr","initValue","getAttributeType","setAttributeNS","_sanitizeShadowDOM","fragment","shadowNode","shadowIterator","nextNode","sanitize","importedNode","returnNode","firstChild","nodeIterator","shadowroot","shadowrootmode","serializedHTML","outerHTML","doctype","setConfig","clearConfig","isValidAttribute","tag","addHook","entryPoint","hookFunction","removeHook","removeHooks","removeAllHooks","Message","timestamp","Date","isLoading","messageContainer","className","messageContent","createLoadingContent","createTextContent","messageTime","formatTime","classList","add","requestAnimationFrame","typingDots","dot","sanitizedContent","updateContent","newContent","opacity","date","verbose","hours","getHours","minutes","getMinutes","ampm","displayHours","padStart","getElement","createLoadingMessage","createErrorMessage","errorText","ChatInput","onSendMessage","isDisabled","setupEventListeners","form","inputContainer","textarea","placeholder","rows","fontSize","sendButton","getSendIcon","getTextarea","getForm","handlers","input","autoResize","bind","keydown","e","key","shiftKey","preventDefault","handleSubmit","submit","containerClick","target","closest","isMobileLike","focus","preventScroll","err","scrollIntoView","behavior","block","addEventListener","height","newHeight","scrollHeight","disable","button","getSendButton","disabled","enable","matchMedia","ua","navigator","userAgent","removeEventListener","HistoryAPI","baseUrl","getBaseUrl","getConversationHistory","endpoint","ChatUI","shadowWrapper","chatAPI","messages","isAtBottom","intersectionObserver","historyAPI","setupScrollObserver","applyTheme","setupMobileViewportHandlers","skipGreeting","showGreeting","header","isFloating","messagesContainer","chatInput","errorToast","createErrorToast","setupFloatingWidget","injectHistory","history","clearMessages","msgData","sender","uiSender","addMessageToUI","scrollToBottom","toast","retryButton","hideErrorToast","closeButton","sentinel","IntersectionObserver","entry","isIntersecting","threshold","observe","_vvHandlers","onFocus","enableViewportTracking","onBlur","disableViewportTracking","vv","visualViewport","h","innerHeight","max","floor","setProperty","_vvApply","removeProperty","messageText","userMessage","addMessage","loadingBotMessage","removeLastMessage","showErrorToast","messageElement","lastElementChild","lastElement","scrollTop","theme","startsWith","applyCustomTheme","primaryColor","customTheme","generateCustomTheme","themeMode","explicitMode","rgb","hexToRgb","isLight","calculateLuminance","g","b","adjustBrightness","hex","result","exec","parseInt","rs","gs","bs","map","factor","adjust","adjusted","round","slice","loadConversationHistory","greetingMessage","collapseBtn","collapseWidget","collapsedContainer","getElementById","expandBtn","closeBtn","expandWidget","closeWidget","applyStoredState","saveState","widgetContainer","display","saveWidgetState","state","stateKey","getWidgetStateKey","localStorage","setItem","getStoredWidgetState","getItem","location","hostname","__chatbotInitialState","presetState","storedState","defaultState","floatingDefaultState","finalState","disconnect","ChatbotWidget","isInitialized","chatUI","init","unmount","getOrCreateSessionId","configWithSession","validateConfig","styleElement","sessionKey","sessionStorage","required","field","locale","send","widgets","Map","scriptSiteKey","scripts","widgetScripts","script","getCurrentScriptSiteKey","configWithSiteKey","has","widget","values","next","delete","clear","getInstance"],"mappings":"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","x_google_ignoreList":[3]}